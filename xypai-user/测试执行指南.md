# XiangYuPai User Module - æµ‹è¯•æ‰§è¡ŒæŒ‡å—

## ğŸ“š å¿«é€Ÿå¼€å§‹

### æ–¹å¼1: ä½¿ç”¨æµ‹è¯•è„šæœ¬ (æ¨è)

**Windowsç³»ç»Ÿ:**
```batch
# è¿›å…¥æ¨¡å—ç›®å½•
cd e:\Users\Administrator\Documents\GitHub\RuoYi-Cloud-Plus\xypai-user

# è¿è¡Œæµ‹è¯•è„šæœ¬
run-tests.bat
```

**Linux/Macç³»ç»Ÿ:**
```bash
# è¿›å…¥æ¨¡å—ç›®å½•
cd /path/to/RuoYi-Cloud-Plus/xypai-user

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test
```

### æ–¹å¼2: ç›´æ¥ä½¿ç”¨Mavenå‘½ä»¤

```bash
# 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test -pl xypai-user

# 2. è¿è¡Œå¹¶æ˜¾ç¤ºè¯¦ç»†è¾“å‡º
mvn test -pl xypai-user -X

# 3. è·³è¿‡æµ‹è¯•(ç”¨äºå¿«é€Ÿæ„å»º)
mvn package -DskipTests -pl xypai-user

# 4. æ¸…ç†åé‡æ–°æµ‹è¯•
mvn clean test -pl xypai-user
```

---

## ğŸ¯ åˆ†ç±»è¿è¡Œæµ‹è¯•

### 1. æŒ‰æµ‹è¯•å±‚çº§è¿è¡Œ

```bash
# åªè¿è¡Œæ§åˆ¶å™¨æµ‹è¯• (165+ç”¨ä¾‹)
mvn test -pl xypai-user -Dtest=*ControllerTest

# åªè¿è¡ŒæœåŠ¡å±‚æµ‹è¯• (70+ç”¨ä¾‹)
mvn test -pl xypai-user -Dtest=*ServiceTest

# åªè¿è¡Œé›†æˆæµ‹è¯• (16ä¸ªE2Eæµç¨‹)
mvn test -pl xypai-user -Dtest=*IntegrationTest
```

### 2. æŒ‰åŠŸèƒ½æ¨¡å—è¿è¡Œ

```bash
# ç”¨æˆ·èµ„æ–™ç›¸å…³æµ‹è¯•
mvn test -pl xypai-user -Dtest=ProfileControllerTest,UserServiceTest

# æŠ€èƒ½ç®¡ç†ç›¸å…³æµ‹è¯•
mvn test -pl xypai-user -Dtest=SkillControllerTest,SkillConfigControllerTest,SkillServiceTest

# ç”¨æˆ·å…³ç³»ç›¸å…³æµ‹è¯•
mvn test -pl xypai-user -Dtest=RelationControllerTest,RelationServiceTest
```

### 3. è¿è¡Œç‰¹å®šæµ‹è¯•ç±»

```bash
# è¿è¡ŒProfileControlleræµ‹è¯•
mvn test -pl xypai-user -Dtest=ProfileControllerTest

# è¿è¡ŒSkillServiceæµ‹è¯•
mvn test -pl xypai-user -Dtest=SkillServiceTest

# è¿è¡Œä¸ªäººèµ„æ–™ç¼–è¾‘é›†æˆæµ‹è¯•
mvn test -pl xypai-user -Dtest=ProfileEditIntegrationTest
```

### 4. è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•

```bash
# è¿è¡Œå•ä¸ªæµ‹è¯•æ–¹æ³•
mvn test -pl xypai-user -Dtest=ProfileControllerTest#testGetProfileHeader_Success

# è¿è¡Œå¤šä¸ªæµ‹è¯•æ–¹æ³•
mvn test -pl xypai-user -Dtest=ProfileControllerTest#testGetProfileHeader_Success+testUpdateNickname_Success
```

---

## ğŸ“Š ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š

### 1. Surefireæµ‹è¯•æŠ¥å‘Š

```bash
# è¿è¡Œæµ‹è¯•å¹¶ç”ŸæˆHTMLæŠ¥å‘Š
mvn test surefire-report:report -pl xypai-user

# æŠ¥å‘Šä½ç½®
xypai-user/target/site/surefire-report.html
```

**æŠ¥å‘Šå†…å®¹åŒ…æ‹¬:**
- âœ… æµ‹è¯•é€šè¿‡/å¤±è´¥ç»Ÿè®¡
- â±ï¸ æµ‹è¯•æ‰§è¡Œæ—¶é—´
- ğŸ“‹ è¯¦ç»†çš„æµ‹è¯•ç”¨ä¾‹åˆ—è¡¨
- âŒ å¤±è´¥æµ‹è¯•çš„è¯¦ç»†ä¿¡æ¯

### 2. JaCoCoä»£ç è¦†ç›–ç‡æŠ¥å‘Š

```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn jacoco:prepare-agent test jacoco:report -pl xypai-user

# æŠ¥å‘Šä½ç½®
xypai-user/target/site/jacoco/index.html
```

**è¦†ç›–ç‡æŠ¥å‘ŠåŒ…æ‹¬:**
- ğŸ“ˆ æ•´ä½“ä»£ç è¦†ç›–ç‡
- ğŸ“¦ æŒ‰åŒ…çš„è¦†ç›–ç‡
- ğŸ“„ æŒ‰ç±»çš„è¦†ç›–ç‡
- ğŸ” è¡Œçº§è¦†ç›–è¯¦æƒ…

### 3. ç»¼åˆæµ‹è¯•æŠ¥å‘Š

```bash
# ç”Ÿæˆå®Œæ•´çš„Mavenç«™ç‚¹(åŒ…å«æ‰€æœ‰æŠ¥å‘Š)
mvn site -pl xypai-user

# æŠ¥å‘Šä½ç½®
xypai-user/target/site/index.html
```

---

## ğŸ”§ IDEä¸­è¿è¡Œæµ‹è¯•

### IntelliJ IDEA

**è¿è¡Œå•ä¸ªæµ‹è¯•ç±»:**
1. æ‰“å¼€æµ‹è¯•ç±»æ–‡ä»¶
2. å³é”®ç‚¹å‡»ç±»åæˆ–æ–¹æ³•å
3. é€‰æ‹© `Run 'TestClassName'` æˆ– `Debug 'TestClassName'`

**è¿è¡Œæ•´ä¸ªæµ‹è¯•åŒ…:**
1. åœ¨é¡¹ç›®è§†å›¾ä¸­å³é”®ç‚¹å‡» `src/test/java`
2. é€‰æ‹© `Run 'All Tests'`

**æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡:**
1. å³é”®ç‚¹å‡»æµ‹è¯•ç±»æˆ–åŒ…
2. é€‰æ‹© `Run 'Tests' with Coverage`
3. æŸ¥çœ‹è¦†ç›–ç‡è§†å›¾

**å¿«æ·é”®:**
- `Ctrl + Shift + F10`: è¿è¡Œå½“å‰æµ‹è¯•
- `Ctrl + Shift + F9`: Debugå½“å‰æµ‹è¯•
- `Ctrl + Shift + F10` (å†æ¬¡): é‡æ–°è¿è¡Œä¸Šæ¬¡çš„æµ‹è¯•

### Eclipse

**è¿è¡Œæµ‹è¯•:**
1. å³é”®ç‚¹å‡»æµ‹è¯•ç±»
2. é€‰æ‹© `Run As` -> `JUnit Test`

**æŸ¥çœ‹æµ‹è¯•ç»“æœ:**
- JUnitè§†å›¾ä¼šè‡ªåŠ¨æ‰“å¼€,æ˜¾ç¤ºæµ‹è¯•ç»“æœ

### VS Code

**å‰ææ¡ä»¶:**
- å®‰è£… `Java Test Runner` æ’ä»¶

**è¿è¡Œæµ‹è¯•:**
1. æ‰“å¼€æµ‹è¯•æ–‡ä»¶
2. ç‚¹å‡»æ–¹æ³•æ—è¾¹çš„ `Run Test` æŒ‰é’®
3. æˆ–ä½¿ç”¨å‘½ä»¤é¢æ¿ (`Ctrl + Shift + P`) -> `Java: Run Tests`

---

## ğŸ› è°ƒè¯•æµ‹è¯•

### 1. å¯ç”¨è°ƒè¯•è¾“å‡º

```bash
# æ˜¾ç¤ºå®Œæ•´çš„æµ‹è¯•è¾“å‡º
mvn test -pl xypai-user -X

# æ˜¾ç¤ºSpring Bootæ—¥å¿—
mvn test -pl xypai-user -Dlogging.level.org.dromara=DEBUG
```

### 2. åœ¨IDEä¸­è°ƒè¯•

**IntelliJ IDEA:**
1. åœ¨æµ‹è¯•æ–¹æ³•ä¸­è®¾ç½®æ–­ç‚¹
2. å³é”®é€‰æ‹© `Debug 'TestMethod'`
3. ä½¿ç”¨è°ƒè¯•å·¥å…·æ æ§åˆ¶æ‰§è¡Œ

**æ–­ç‚¹æŠ€å·§:**
- `Ctrl + F8`: åˆ‡æ¢æ–­ç‚¹
- `F9`: ç»§ç»­æ‰§è¡Œ
- `F8`: å•æ­¥æ‰§è¡Œ
- `F7`: è¿›å…¥æ–¹æ³•

### 3. æŸ¥çœ‹æµ‹è¯•å¤±è´¥è¯¦æƒ…

```bash
# æµ‹è¯•å¤±è´¥å,æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
cat xypai-user/target/surefire-reports/TEST-*.xml
```

---

## ğŸ“‹ æµ‹è¯•æ£€æŸ¥æ¸…å•

### è¿è¡Œå‰æ£€æŸ¥

- [ ] Java 17+ å·²å®‰è£…
- [ ] Maven 3.8+ å·²å®‰è£…
- [ ] ç¯å¢ƒå˜é‡é…ç½®æ­£ç¡® (JAVA_HOME, MAVEN_HOME)
- [ ] é¡¹ç›®ä¾èµ–å·²ä¸‹è½½ (`mvn dependency:resolve`)
- [ ] H2æ•°æ®åº“ä¾èµ–å·²æ·»åŠ åˆ°pom.xml

### æµ‹è¯•ç¯å¢ƒæ£€æŸ¥

```bash
# æ£€æŸ¥Javaç‰ˆæœ¬
java -version

# æ£€æŸ¥Mavenç‰ˆæœ¬
mvn -version

# æ£€æŸ¥é¡¹ç›®ä¾èµ–
mvn dependency:tree -pl xypai-user

# éªŒè¯æµ‹è¯•é…ç½®
mvn validate -pl xypai-user
```

### è¿è¡Œåæ£€æŸ¥

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ (ç»¿è‰² âœ…)
- [ ] æ— è·³è¿‡çš„æµ‹è¯•
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%
- [ ] æ— ç¼–è¯‘è­¦å‘Š
- [ ] æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ

---

## ğŸš¨ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1: æµ‹è¯•æ‰¾ä¸åˆ° (No tests found)

**åŸå› :**
- æµ‹è¯•ç±»åä¸ç¬¦åˆè§„èŒƒ
- æµ‹è¯•æ–¹æ³•æ²¡æœ‰ `@Test` æ³¨è§£

**è§£å†³æ–¹æ¡ˆ:**
```bash
# ç¡®ä¿æµ‹è¯•ç±»åä»¥Testç»“å°¾
ProfileControllerTest.java âœ…
ProfileController.java âŒ

# ç¡®ä¿æµ‹è¯•æ–¹æ³•æœ‰@Testæ³¨è§£
@Test
public void testMethod() { ... }
```

### é—®é¢˜2: H2æ•°æ®åº“è¿æ¥å¤±è´¥

**åŸå› :**
- H2ä¾èµ–ç¼ºå¤±
- æ•°æ®åº“URLé…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆ:**
```bash
# æ£€æŸ¥pom.xmlæ˜¯å¦æœ‰H2ä¾èµ–
<dependency>
    <groupId>com.h2database</groupId>
    <artifactId>h2</artifactId>
    <scope>test</scope>
</dependency>

# æ£€æŸ¥application-test.ymlé…ç½®
spring:
  datasource:
    url: jdbc:h2:mem:testdb
```

### é—®é¢˜3: Mockå¯¹è±¡è¿”å›null

**åŸå› :**
- Mockå¯¹è±¡æœªæ­£ç¡®åˆå§‹åŒ–
- when-thené…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ¡ˆ:**
```java
// ç¡®ä¿Mockæ³¨è§£
@Mock
private IUserService userService;

// ç¡®ä¿InjectMocksæ³¨è§£
@InjectMocks
private ProfileController profileController;

// ç¡®ä¿when-thené…ç½®
when(userService.getUserProfile(anyLong()))
    .thenReturn(R.ok(mockData));
```

### é—®é¢˜4: æµ‹è¯•è¿è¡Œç¼“æ…¢

**åŸå› :**
- æ•°æ®åº“åˆå§‹åŒ–æ…¢
- è¿‡å¤šçš„é›†æˆæµ‹è¯•

**è§£å†³æ–¹æ¡ˆ:**
```bash
# åªè¿è¡Œå¿«é€Ÿçš„å•å…ƒæµ‹è¯•
mvn test -pl xypai-user -Dtest=*ControllerTest,*ServiceTest

# è·³è¿‡æ…¢é€Ÿé›†æˆæµ‹è¯•
mvn test -pl xypai-user -Dtest=!*IntegrationTest
```

### é—®é¢˜5: ç«¯å£è¢«å ç”¨

**åŸå› :**
- ä¹‹å‰çš„æµ‹è¯•è¿›ç¨‹æœªå…³é—­
- å…¶ä»–åº”ç”¨å ç”¨ç«¯å£

**è§£å†³æ–¹æ¡ˆ:**
```bash
# Windows: æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :8080

# ç»ˆæ­¢è¿›ç¨‹
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac:
lsof -i :8080
kill -9 <PID>
```

### é—®é¢˜6: å†…å­˜ä¸è¶³ (OutOfMemoryError)

**è§£å†³æ–¹æ¡ˆ:**
```bash
# å¢åŠ Mavenå†…å­˜
set MAVEN_OPTS=-Xmx1024m -XX:MaxPermSize=256m

# æˆ–åœ¨pom.xmlä¸­é…ç½®
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <configuration>
        <argLine>-Xmx1024m</argLine>
    </configuration>
</plugin>
```

---

## ğŸ“ˆ æ€§èƒ½æµ‹è¯•

### 1. æµ‹è¯•æ‰§è¡Œæ—¶é—´ç»Ÿè®¡

```bash
# æ˜¾ç¤ºæ¯ä¸ªæµ‹è¯•çš„æ‰§è¡Œæ—¶é—´
mvn test -pl xypai-user | grep "Time elapsed"
```

### 2. è®¾ç½®æµ‹è¯•è¶…æ—¶

```java
@Test
@Timeout(value = 5, unit = TimeUnit.SECONDS)
public void testWithTimeout() {
    // æµ‹è¯•å¿…é¡»åœ¨5ç§’å†…å®Œæˆ
}
```

### 3. å¹¶è¡Œæ‰§è¡Œæµ‹è¯•

```xml
<!-- pom.xml -->
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-surefire-plugin</artifactId>
    <configuration>
        <parallel>classes</parallel>
        <threadCount>4</threadCount>
    </configuration>
</plugin>
```

---

## ğŸ”„ æŒç»­é›†æˆ (CI/CD)

### GitHub Actionsç¤ºä¾‹

```yaml
name: Run Tests

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2

      - name: Set up JDK 17
        uses: actions/setup-java@v2
        with:
          java-version: '17'
          distribution: 'adopt'

      - name: Cache Maven packages
        uses: actions/cache@v2
        with:
          path: ~/.m2
          key: ${{ runner.os }}-m2-${{ hashFiles('**/pom.xml') }}

      - name: Run tests
        run: mvn test -pl xypai-user

      - name: Generate test report
        run: mvn surefire-report:report -pl xypai-user

      - name: Upload test results
        uses: actions/upload-artifact@v2
        with:
          name: test-results
          path: xypai-user/target/surefire-reports/

      - name: Upload coverage to Codecov
        uses: codecov/codecov-action@v2
        with:
          files: xypai-user/target/site/jacoco/jacoco.xml
```

### Jenkins Pipelineç¤ºä¾‹

```groovy
pipeline {
    agent any

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Test') {
            steps {
                sh 'mvn test -pl xypai-user'
            }
        }

        stage('Report') {
            steps {
                sh 'mvn surefire-report:report -pl xypai-user'
                publishHTML([
                    reportDir: 'xypai-user/target/site',
                    reportFiles: 'surefire-report.html',
                    reportName: 'Test Report'
                ])
            }
        }
    }

    post {
        always {
            junit 'xypai-user/target/surefire-reports/*.xml'
        }
    }
}
```

---

## ğŸ“š æµ‹è¯•æ•°æ®ç®¡ç†

### æŸ¥çœ‹æµ‹è¯•æ•°æ®

æµ‹è¯•æ•°æ®åœ¨æ¯æ¬¡æµ‹è¯•å‰è‡ªåŠ¨åˆå§‹åŒ–:

**ä½ç½®:** `src/test/resources/data.sql`

**æµ‹è¯•ç”¨æˆ·:**
- `user_id=1000`: ä¸»æµ‹è¯•ç”¨æˆ·
- `user_id=2000`: å…¶ä»–ç”¨æˆ·
- `user_id=2001-2006`: ç²‰ä¸/å…³æ³¨ç”¨æˆ·
- `user_id=3000`: éšç§ç”¨æˆ·

**æµ‹è¯•æŠ€èƒ½:**
- `skill_id=3000`: çº¿ä¸ŠæŠ€èƒ½(ç‹è€…è£è€€)
- `skill_id=3001`: çº¿ä¸‹æŠ€èƒ½(æ‘„å½±æœåŠ¡)
- `skill_id=3002-3005`: å…¶ä»–æµ‹è¯•æŠ€èƒ½

### è‡ªå®šä¹‰æµ‹è¯•æ•°æ®

```sql
-- æ·»åŠ è‡ªå®šä¹‰æµ‹è¯•æ•°æ®
INSERT INTO `user` (user_id, username, nickname, ...) VALUES
(9000, 'customuser', 'è‡ªå®šä¹‰ç”¨æˆ·', ...);

-- åœ¨æµ‹è¯•æ–¹æ³•ä¸­ä½¿ç”¨
@Test
public void testCustomUser() {
    Long customUserId = 9000L;
    // ... æµ‹è¯•é€»è¾‘
}
```

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. æµ‹è¯•å‘½åè§„èŒƒ

```java
// âœ… å¥½çš„å‘½å
@Test
@DisplayName("TC-PROFILE-001: è·å–ä¸ªäººä¸»é¡µå¤´éƒ¨ä¿¡æ¯ - æˆåŠŸ")
public void testGetProfileHeader_Success() { }

// âŒ ä¸å¥½çš„å‘½å
@Test
public void test1() { }
```

### 2. AAAæ¨¡å¼ (Arrange-Act-Assert)

```java
@Test
public void testExample() {
    // Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®
    UserProfileVo mockProfile = UserProfileVo.builder()
        .userId(TEST_USER_ID)
        .build();

    // Act: æ‰§è¡Œæ“ä½œ
    R<UserProfileVo> result = userService.getUserProfile(TEST_USER_ID);

    // Assert: éªŒè¯ç»“æœ
    assertNotNull(result);
    assertTrue(result.isSuccess());
}
```

### 3. æµ‹è¯•éš”ç¦»

```java
@BeforeEach
public void setUp() {
    // æ¯ä¸ªæµ‹è¯•å‰é‡ç½®çŠ¶æ€
}

@AfterEach
public void tearDown() {
    // æ¯ä¸ªæµ‹è¯•åæ¸…ç†èµ„æº
}
```

### 4. ä½¿ç”¨æœ‰æ„ä¹‰çš„æ–­è¨€æ¶ˆæ¯

```java
// âœ… å¥½çš„æ–­è¨€
assertEquals(expected, actual, "ç”¨æˆ·æ˜µç§°åº”è¯¥åŒ¹é…");

// âŒ ä¸å¥½çš„æ–­è¨€
assertEquals(expected, actual);
```

---

## ğŸ“ è·å–å¸®åŠ©

### æ–‡æ¡£èµ„æº

- **æµ‹è¯•å¥—ä»¶æ–‡æ¡£**: `src/test/README.md`
- **åˆ›å»ºæ€»ç»“**: `æµ‹è¯•å¥—ä»¶åˆ›å»ºæ€»ç»“.md`
- **å‰ç«¯å¯¹æ¥**: `å‰ç«¯æ¥å£äº¤æ¥æ–‡æ¡£.md`
- **å®Œæ•´æµ‹è¯•ç”¨ä¾‹**: `å®Œæ•´æµ‹è¯•ç”¨ä¾‹æ–‡æ¡£.md`

### å‘½ä»¤å¸®åŠ©

```bash
# Mavenæµ‹è¯•æ’ä»¶å¸®åŠ©
mvn help:describe -Dplugin=surefire -Ddetail

# æŸ¥çœ‹å¯ç”¨çš„æµ‹è¯•ç›®æ ‡
mvn help:describe -Dcmd=test
```

### è”ç³»æ–¹å¼

- **æŠ€æœ¯é—®é¢˜**: backend-team@xiangyupai.com
- **æµ‹è¯•é—®é¢˜**: qa-team@xiangyupai.com
- **æ–‡æ¡£é—®é¢˜**: æäº¤Issueåˆ°é¡¹ç›®ä»“åº“

---

**ç‰ˆæœ¬**: v1.0.0
**æ›´æ–°æ—¥æœŸ**: 2025-11-15
**ç»´æŠ¤**: XiangYuPai Backend Team
