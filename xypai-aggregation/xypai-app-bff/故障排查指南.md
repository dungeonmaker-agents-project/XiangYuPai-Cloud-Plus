# XyPai App BFF æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ“ å½“å‰é—®é¢˜

### é—®é¢˜ç°è±¡
```
2025-11-24 21:10:11 [XNIO-1 task-2] WARN  o.s.web.servlet.PageNotFound
 - No mapping for GET /api/home/limited-time/list
```

### é—®é¢˜åŸå› 
**åŒ…ç»“æ„å˜æ›´åæœåŠ¡æœªé‡å¯**

ä¹‹å‰çš„ä»£ç æœ‰ä¸¤ä¸ªåŒ…ç»“æ„ï¼š
- âŒ æ—§åŒ…: `org.dromara.aggregation.*`
- âœ… æ–°åŒ…: `org.dromara.appbff.*`

æˆ‘ä»¬å·²ç»ç»Ÿä¸€ä¸º `org.dromara.appbff` åŒ…ï¼Œä½†æ˜¯ï¼š
1. **æ—§çš„æœåŠ¡è¿›ç¨‹è¿˜åœ¨è¿è¡Œ** (ä½¿ç”¨æ—§çš„å¯åŠ¨ç±» `org.dromara.aggregation.XyPaiAppBffApplication`)
2. æ—§è¿›ç¨‹ä¸­çš„ Spring æ²¡æœ‰æ‰«æåˆ°æ–°åŒ…ä¸‹çš„ `HomeLimitedTimeController`
3. æ‰€ä»¥è®¿é—® `/api/home/limited-time/list` è¿”å› 404

---

## âœ… è§£å†³æ–¹æ¡ˆ

### æ–¹æ³• 1: IDE é‡å¯ (æ¨è)

1. **åœæ­¢æ—§è¿›ç¨‹**
   - åœ¨ IntelliJ IDEA ä¸­æ‰¾åˆ°æ­£åœ¨è¿è¡Œçš„ `XyPaiAppBffApplication`
   - ç‚¹å‡»çº¢è‰²åœæ­¢æŒ‰é’®

2. **æ›´æ–°å¯åŠ¨é…ç½®**
   - Edit Configurations
   - æ‰¾åˆ° `XyPaiAppBffApplication` é…ç½®
   - Main class æ”¹ä¸º: `org.dromara.appbff.XyPaiAppBffApplication`
   - Module: `xypai-app-bff`

3. **é‡æ–°å¯åŠ¨**
   - ç‚¹å‡»ç»¿è‰²è¿è¡ŒæŒ‰é’®
   - æŸ¥çœ‹å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤åŒ…æ‰«ææ­£ç¡®

### æ–¹æ³• 2: å‘½ä»¤è¡Œé‡å¯

```bash
# 1. åœæ­¢æ—§è¿›ç¨‹ (Windows)
tasklist | findstr "java"
taskkill /F /PID <è¿›ç¨‹ID>

# 2. é‡æ–°ç¼–è¯‘
cd E:\Users\Administrator\Documents\GitHub\RuoYi-Cloud-Plus\xypai-aggregation\xypai-app-bff
mvn clean package -DskipTests

# 3. å¯åŠ¨æ–°è¿›ç¨‹
java -jar target/xypai-app-bff.jar
```

---

## ğŸ” éªŒè¯å¯åŠ¨æˆåŠŸ

### 1. æ£€æŸ¥å¯åŠ¨æ—¥å¿—

**æ­£ç¡®çš„æ—¥å¿—åº”è¯¥åŒ…å«**:
```
Started XyPaiAppBffApplication in X.XXX seconds
(â™¥â— â€¿â— )ãƒã‚™  XyPai App BFFèšåˆæœåŠ¡å¯åŠ¨æˆåŠŸ   áƒš(Â´Ú¡`áƒš)ã‚™

Mapped "{[/api/home/limited-time/list],methods=[GET]}" onto ...
Mapped "{[/api/home/filter/config],methods=[GET]}" onto ...
Mapped "{[/api/home/search/init],methods=[GET]}" onto ...
```

**å¦‚æœçœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¯´æ˜åŒ…æ‰«æé”™è¯¯**:
```
No mapping for GET /api/home/limited-time/list
```

### 2. æ£€æŸ¥ Nacos æ³¨å†Œ

è®¿é—® Nacos æ§åˆ¶å°: http://localhost:8848/nacos

- æœåŠ¡å: `xypai-app-bff`
- å®ä¾‹æ•°: 1
- å¥åº·çŠ¶æ€: âœ…

### 3. æ£€æŸ¥ç«¯å£ç›‘å¬

```bash
# Windows
netstat -ano | findstr :9400

# åº”è¯¥çœ‹åˆ°
TCP    0.0.0.0:9400    0.0.0.0:0    LISTENING    <PID>
```

### 4. æµ‹è¯•æ¥å£

```bash
# é€šè¿‡ Gateway è®¿é—® (éœ€è¦ Token)
curl -X GET "http://localhost:9300/xypai-app-bff/api/home/limited-time/list?pageNum=1&pageSize=10" \
  -H "Authorization: Bearer <your-token>"

# ç›´æ¥è®¿é—®æœåŠ¡ (ç»•è¿‡ Gatewayï¼Œä¸éœ€è¦ Token)
curl -X GET "http://localhost:9400/api/home/limited-time/list?pageNum=1&pageSize=10"
```

**æœŸæœ›å“åº”**:
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": {
    "total": 25,
    "hasMore": true,
    "list": [...]
  }
}
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: å¯åŠ¨å¤±è´¥ - ç«¯å£è¢«å ç”¨

**é”™è¯¯æ—¥å¿—**:
```
Port 9400 was already in use.
```

**è§£å†³æ–¹æ¡ˆ**:
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :9400

# æ€æ‰è¿›ç¨‹
taskkill /F /PID <è¿›ç¨‹ID>

# é‡æ–°å¯åŠ¨
```

---

### é—®é¢˜ 2: RPC è°ƒç”¨å¤±è´¥ - æ‰¾ä¸åˆ° Provider

**é”™è¯¯æ—¥å¿—**:
```
No provider available for service org.dromara.appuser.api.RemoteAppUserService
```

**åŸå› **: xypai-user æœåŠ¡æœªå¯åŠ¨æˆ–æœªåœ¨ Nacos æ³¨å†Œ

**è§£å†³æ–¹æ¡ˆ**:
1. å¯åŠ¨ `xypai-user` æœåŠ¡ (ç«¯å£ 9401)
2. æ£€æŸ¥ Nacos æ˜¯å¦æœ‰ `xypai-user` æœåŠ¡æ³¨å†Œ
3. æ£€æŸ¥ Dubbo é…ç½®æ˜¯å¦æ­£ç¡®

---

### é—®é¢˜ 3: æ•°æ®åº“æŸ¥è¯¢å¤±è´¥

**é”™è¯¯æ—¥å¿—**:
```
Table 'xypai_user.users' doesn't exist
```

**åŸå› **: æ•°æ®åº“è¡¨æœªåˆ›å»ºæˆ–æµ‹è¯•æ•°æ®æœªæ’å…¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. æ‰§è¡Œå»ºè¡¨è„šæœ¬
mysql -u root -p xypai_user < sql/create_tables.sql

# 2. æ’å…¥æµ‹è¯•æ•°æ®
mysql -u root -p xypai_user < sql/xypai_user_test_data.sql

# 3. éªŒè¯æ•°æ®
mysql -u root -p xypai_user -e "SELECT COUNT(*) FROM users;"
```

---

### é—®é¢˜ 4: Gateway 404 ä½†ç›´æ¥è®¿é—®æœåŠ¡æ­£å¸¸

**é”™è¯¯æ—¥å¿—**:
```
Gateway: 404 Not Found
Direct: 200 OK
```

**åŸå› **: Gateway è·¯ç”±é…ç½®é—®é¢˜æˆ–æœåŠ¡æœªåœ¨ Nacos æ³¨å†Œ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥ Gateway é…ç½®æ–‡ä»¶ `application.yml`:
   ```yaml
   spring:
     cloud:
       gateway:
         routes:
           - id: xypai-app-bff
             uri: lb://xypai-app-bff
             predicates:
               - Path=/xypai-app-bff/**
             filters:
               - StripPrefix=1
   ```

2. æ£€æŸ¥ Nacos æœåŠ¡æ³¨å†Œ:
   - æœåŠ¡åå¿…é¡»æ˜¯ `xypai-app-bff`
   - å¥åº·æ£€æŸ¥å¿…é¡»é€šè¿‡

---

### é—®é¢˜ 5: ComponentScan æ‰«æä¸åˆ° Controller

**é”™è¯¯æ—¥å¿—**:
```
No mapping for GET /api/home/limited-time/list
```

**åŸå› **: `@ComponentScan` é…ç½®é”™è¯¯

**æ£€æŸ¥ Application ç±»**:
```java
@SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
@ComponentScan(basePackages = {"org.dromara.appbff", "org.dromara.common"})
public class XyPaiAppBffApplication {
    // ...
}
```

**éªŒè¯**:
- ç¡®ä¿ `basePackages` åŒ…å« `org.dromara.appbff`
- ç¡®ä¿æ‰€æœ‰ Controller åœ¨ `org.dromara.appbff.controller` åŒ…ä¸‹
- ç¡®ä¿ Controller ç±»æœ‰ `@RestController` æ³¨è§£

---

## ğŸ“Š å®Œæ•´å¯åŠ¨æ£€æŸ¥æ¸…å•

### å¯åŠ¨å‰
- [ ] Nacos å·²å¯åŠ¨ (8848)
- [ ] Redis å·²å¯åŠ¨ (6379)
- [ ] MySQL å·²å¯åŠ¨ (3306)
- [ ] xypai_user æ•°æ®åº“å·²åˆ›å»º
- [ ] æµ‹è¯•æ•°æ®å·²æ’å…¥
- [ ] xypai-user æœåŠ¡å·²å¯åŠ¨ (9401)
- [ ] Gateway å·²å¯åŠ¨ (9300)

### å¯åŠ¨æœåŠ¡
- [ ] ä½¿ç”¨æ­£ç¡®çš„å¯åŠ¨ç±»: `org.dromara.appbff.XyPaiAppBffApplication`
- [ ] ç«¯å£ 9400 æœªè¢«å ç”¨
- [ ] å¯åŠ¨æ—¥å¿—æ— é”™è¯¯

### å¯åŠ¨å
- [ ] æœåŠ¡åœ¨ Nacos æ³¨å†ŒæˆåŠŸ
- [ ] ç«¯å£ 9400 ç›‘å¬ä¸­
- [ ] Swagger UI å¯è®¿é—®: http://localhost:9400/doc.html
- [ ] Controller æ˜ å°„æ­£ç¡®æ˜¾ç¤ºåœ¨æ—¥å¿—ä¸­
- [ ] æµ‹è¯•æ¥å£è¿”å› 200

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹æ‰€æœ‰æ³¨å†Œçš„æ¥å£æ˜ å°„

å¯åŠ¨æ—¥å¿—ä¼šæ˜¾ç¤ºæ‰€æœ‰æ˜ å°„çš„æ¥å£:
```
Mapped "{[/api/home/limited-time/list],methods=[GET]}"
  onto org.dromara.appbff.controller.HomeLimitedTimeController.getLimitedTimeList
```

### 2. ä½¿ç”¨ Actuator æŸ¥çœ‹å¥åº·çŠ¶æ€

```bash
curl http://localhost:9400/actuator/health
```

### 3. æŸ¥çœ‹ Dubbo æœåŠ¡å¼•ç”¨

å¯åŠ¨æ—¥å¿—ä¸­æœç´¢ `@DubboReference`:
```
Dubbo service proxy bean [RemoteAppUserService] created successfully
```

### 4. å¼€å¯ DEBUG æ—¥å¿—

åœ¨ `application.yml` ä¸­æ·»åŠ :
```yaml
logging:
  level:
    org.dromara.appbff: DEBUG
    org.apache.dubbo: DEBUG
```

---

## ğŸ“ æ€»ç»“

å½“å‰é—®é¢˜çš„æ ¹æœ¬åŸå› æ˜¯ï¼š
1. **åŒ…ç»“æ„ç»Ÿä¸€åæœªé‡å¯æœåŠ¡**
2. æ—§è¿›ç¨‹ä½¿ç”¨æ—§çš„å¯åŠ¨ç±»ï¼Œæ‰«æçš„æ˜¯æ—§åŒ…å
3. æ–°åŒ…ä¸‹çš„ Controller æ²¡æœ‰è¢«æ‰«æåˆ°

**ç«‹å³æ“ä½œ**:
1. åœæ­¢ xypai-app-bff æœåŠ¡
2. ç¡®è®¤å¯åŠ¨ç±»ä¸º `org.dromara.appbff.XyPaiAppBffApplication`
3. é‡æ–°å¯åŠ¨æœåŠ¡
4. éªŒè¯æ¥å£å¯è®¿é—®

---

**æœ€åæ›´æ–°**: 2025-11-24
**çŠ¶æ€**: é—®é¢˜è¯Šæ–­å®Œæˆï¼Œç­‰å¾…é‡å¯éªŒè¯
