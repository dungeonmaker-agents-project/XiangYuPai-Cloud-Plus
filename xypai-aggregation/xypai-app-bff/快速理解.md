# XyPai-App-BFF App ç«¯ä¸šåŠ¡ç¼–æ’æœåŠ¡å¿«é€Ÿç†è§£

## ğŸ“Œ æ ¸å¿ƒå®šä½
å‘å¨±æ‹ App ç«¯ä¸šåŠ¡ç¼–æ’æœåŠ¡ï¼ˆBackend For Frontendï¼‰ï¼ŒåŸºäº Spring Cloud å¾®æœåŠ¡æ¶æ„ã€‚

**æœ¬æ¨¡å—èŒè´£**ï¼šä¸º App å®¢æˆ·ç«¯æä¾›èšåˆæ¥å£ï¼Œä¸ç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡ Feign RPC è°ƒç”¨å¤šä¸ªé¢†åŸŸæœåŠ¡ï¼ˆuserã€contentã€order ç­‰ï¼‰ï¼Œå®ç°ä¸šåŠ¡ç¼–æ’ã€æ•°æ®èšåˆã€æ¨èç®—æ³•ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½
- **é¦–é¡µ Feed æµ**ï¼šç”¨æˆ·æ¨èï¼ˆçº¿ä¸Š/çº¿ä¸‹ï¼‰+ è·ç¦»è®¡ç®— + æŠ€èƒ½åŒ¹é…
- **å‘ç°é¡µèšåˆ**ï¼šå†…å®¹æµ + ç”¨æˆ·ä¿¡æ¯ + äº’åŠ¨æ•°æ®ä¸€æ¬¡è¿”å›
- **ç”¨æˆ·ä¸»é¡µèšåˆ**ï¼šç”¨æˆ·èµ„æ–™ + åŠ¨æ€åˆ—è¡¨ + æŠ€èƒ½ + ç²‰ä¸æ•°ç»Ÿè®¡
- **è®¢å•è¯¦æƒ…èšåˆ**ï¼šè®¢å• + ç”¨æˆ·ä¿¡æ¯ + æ”¯ä»˜ä¿¡æ¯å®Œæ•´è¿”å›
- **æ¨èç®—æ³•**ï¼šåŸºäºè·ç¦»ã€æŠ€èƒ½ã€æ´»è·ƒåº¦çš„ç”¨æˆ·åŒ¹é…å¼•æ“

## ğŸ—ï¸ æŠ€æœ¯æ ˆ
```
Spring Boot 3.x + Spring Cloud OpenFeign + Nacos
Redis (æ¨èç»“æœç¼“å­˜ + ç”¨æˆ·ç”»åƒç¼“å­˜)
```

## ğŸ“ æ ¸å¿ƒç›®å½•ç»“æ„
```
xypai-app-bff/
â”œâ”€â”€ controller/
â”‚   â”œâ”€â”€ HomeFeedController.java          # âœ… é¦–é¡µ Feed æµï¼ˆç”¨æˆ·æ¨èï¼‰
â”‚   â”œâ”€â”€ HomeFilterController.java        # âœ… é¦–é¡µç­›é€‰ï¼ˆé…ç½®+åº”ç”¨ï¼‰
â”‚   â”œâ”€â”€ DiscoveryController.java         # â³ å‘ç°é¡µï¼ˆå†…å®¹èšåˆï¼‰
â”‚   â”œâ”€â”€ ProfileAggController.java        # â³ ç”¨æˆ·ä¸»é¡µèšåˆ
â”‚   â””â”€â”€ OrderAggController.java          # â³ è®¢å•è¯¦æƒ…èšåˆ
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ HomeFeedBizService.java          # é¦–é¡µä¸šåŠ¡é€»è¾‘
â”‚   â”œâ”€â”€ RecommendationEngine.java        # æ¨èç®—æ³•å¼•æ“
â”‚   â””â”€â”€ DataAggregationService.java      # é€šç”¨æ•°æ®èšåˆå·¥å…·
â”œâ”€â”€ client/                               # Feign å®¢æˆ·ç«¯ï¼ˆRPC è°ƒç”¨ï¼‰
â”‚   â”œâ”€â”€ UserServiceClient.java           # â†’ xypai-user (9401)
â”‚   â”œâ”€â”€ ContentServiceClient.java        # â†’ xypai-content (9403)
â”‚   â”œâ”€â”€ OrderServiceClient.java          # â†’ xypai-order (9405)
â”‚   â””â”€â”€ PaymentServiceClient.java        # â†’ xypai-payment (9406)
â””â”€â”€ domain/
    â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ HomeFeedQueryDTO.java        # é¦–é¡µæŸ¥è¯¢è¯·æ±‚
    â”‚   â””â”€â”€ ProfileAggQueryDTO.java      # ä¸»é¡µèšåˆè¯·æ±‚
    â””â”€â”€ vo/
        â”œâ”€â”€ UserCardVO.java              # ç”¨æˆ·å¡ç‰‡ï¼ˆé¦–é¡µï¼‰
        â””â”€â”€ ProfileFullVO.java           # å®Œæ•´ä¸»é¡µä¿¡æ¯
```

## ğŸ”‘ æ ¸å¿ƒæ¥å£
| æ¥å£ | è¯´æ˜ | èšåˆæ•°æ®æ¥æº | çŠ¶æ€ |
|------|------|-------------|------|
| `GET /api/home/feed` | é¦–é¡µç”¨æˆ·æ¨èæµ | user(ç”¨æˆ·åˆ—è¡¨) + content(åŠ¨æ€æ•°) | â³ Mock |
| `GET /api/home/filter/config` | è·å–ç­›é€‰é…ç½® | - (Mockæ•°æ®) | âœ… å·²å®ç° |
| `POST /api/home/filter/apply` | åº”ç”¨ç­›é€‰æ¡ä»¶ | - (Mockæ•°æ®) | âœ… å·²å®ç° |
| `GET /api/discovery` | å‘ç°é¡µå†…å®¹æµ | content(åŠ¨æ€) + user(ä½œè€…) + interaction(äº’åŠ¨) | â³ å¾…å®ç° |
| `GET /api/profile/{userId}/full` | ç”¨æˆ·ä¸»é¡µå®Œæ•´ä¿¡æ¯ | user(èµ„æ–™+æŠ€èƒ½+ç»Ÿè®¡) + content(åŠ¨æ€) | â³ å¾…å®ç° |
| `GET /api/order/detail/{orderId}` | è®¢å•è¯¦æƒ… | order(è®¢å•) + user(ç”¨æˆ·) + payment(æ”¯ä»˜) | â³ å¾…å®ç° |

## ğŸ›ï¸ å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App å®¢æˆ·ç«¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP REST
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ xypai-app-bff   â”‚  â† æœ¬æ¨¡å—ï¼ˆæ— æ•°æ®åº“ï¼‰
â”‚ (9400)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Feign RPC
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“         â†“        â†“         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚xypai-  â”‚â”‚xypai-  â”‚â”‚xypai-  â”‚â”‚xypai-  â”‚
â”‚user    â”‚â”‚content â”‚â”‚order   â”‚â”‚payment â”‚ é¢†åŸŸæœåŠ¡
â”‚(9401)  â”‚â”‚(9403)  â”‚â”‚(9405)  â”‚â”‚(9406)  â”‚
â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚         â”‚         â”‚         â”‚
  â”Œâ”€â–¼â”€â”€â”   â”Œâ”€â–¼â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”
  â”‚userâ”‚   â”‚contentâ”‚ â”‚orderâ”‚  â”‚paymentâ”‚ æ•°æ®åº“
  â””â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¥ æŠ€æœ¯äº®ç‚¹
1. **BFF æ¨¡å¼**ï¼šå‰ç«¯ä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´æ•°æ®ï¼Œé¿å…å¤šæ¬¡ HTTP è°ƒç”¨ï¼ˆä» 5 æ¬¡ â†’ 1 æ¬¡ï¼‰
2. **æ¨èç®—æ³•**ï¼šç”¨æˆ·åŒ¹é…ç®—æ³•ï¼ˆè·ç¦»æƒé‡ 40% + æŠ€èƒ½åŒ¹é… 30% + æ´»è·ƒåº¦ 20% + åœ¨çº¿çŠ¶æ€ 10%ï¼‰
3. **æ‰¹é‡ RPC**ï¼šä½¿ç”¨ Feign `@PostMapping("/batch")` æ‰¹é‡è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œå‡å°‘ç½‘ç»œå¾€è¿”
4. **æ•°æ®è£å‰ª**ï¼šæ ¹æ®åœºæ™¯è¿”å›å¿…è¦å­—æ®µï¼Œé¦–é¡µç”¨æˆ·å¡ç‰‡ä»…è¿”å› 8 ä¸ªå­—æ®µï¼ˆå®Œæ•´ç”¨æˆ·æœ‰ 33 ä¸ªå­—æ®µï¼‰
5. **ç¼“å­˜ä¼˜åŒ–**ï¼šçƒ­é—¨æ¨èç»“æœç¼“å­˜ 5 åˆ†é’Ÿï¼Œç”¨æˆ·ç”»åƒç¼“å­˜ 30 åˆ†é’Ÿ

## ğŸ“¦ ä¾èµ–å…³ç³»
```
xypai-app-bff (æœ¬æ¨¡å—)
  â†“ Feign RPC è°ƒç”¨
â”œâ”€ xypai-user (ç”¨æˆ·æœåŠ¡)
â”‚   â”œâ”€ getUserById(Long userId)
â”‚   â”œâ”€ getUserProfiles(List<Long> userIds)  # æ‰¹é‡æŸ¥è¯¢
â”‚   â””â”€ getUserStats(Long userId)
â”‚
â”œâ”€ xypai-content (å†…å®¹æœåŠ¡)
â”‚   â”œâ”€ getFeedList(FeedQueryDTO)
â”‚   â”œâ”€ getUserActivities(List<Long> userIds)
â”‚   â””â”€ getInteractionStats(Long feedId)
â”‚
â”œâ”€ xypai-order (è®¢å•æœåŠ¡)
â”‚   â”œâ”€ getOrderDetail(Long orderId)
â”‚   â””â”€ getUserOrders(Long userId)
â”‚
â””â”€ xypai-payment (æ”¯ä»˜æœåŠ¡)
    â””â”€ getPaymentInfo(Long orderId)
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨
```bash
# 1. ç¡®ä¿ä¾èµ–æœåŠ¡å·²å¯åŠ¨
#    - Nacos (8848)
#    - Redis (6379)
#    - xypai-user (9401)
#    - xypai-content (9403)
#    - xypai-order (9405)
#    - xypai-payment (9406)

# 2. å¯åŠ¨æœ¬æœåŠ¡
cd xypai-app-bff
mvn clean package -DskipTests
java -jar target/xypai-app-bff.jar

# é»˜è®¤ç«¯å£ï¼š9400
# Swagger UI: http://localhost:9400/doc.html
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹
- **æ— æ•°æ®åº“è¿æ¥**ï¼šæœ¬æ¨¡å—æ˜¯çº¯ä¸šåŠ¡ç¼–æ’å±‚ï¼Œæ‰€æœ‰æ•°æ®é€šè¿‡ Feign RPC è°ƒç”¨é¢†åŸŸæœåŠ¡è·å–ï¼Œä¸ç›´æ¥è®¿é—®ä»»ä½•æ•°æ®åº“
- **ä¾èµ–æœåŠ¡å¯åŠ¨é¡ºåº**ï¼šå¿…é¡»å…ˆå¯åŠ¨é¢†åŸŸæœåŠ¡ï¼ˆuserã€contentã€orderã€paymentï¼‰ï¼Œå¦åˆ™ Feign è°ƒç”¨å¤±è´¥
- é¦–é¡µæ¨èä½¿ç”¨ Redis ç¼“å­˜ 5 åˆ†é’Ÿï¼Œé¿å…é¢‘ç¹è°ƒç”¨æ¨èç®—æ³•
- æ‰¹é‡ RPC è°ƒç”¨æ—¶æ¯æ¬¡æœ€å¤š 50 ä¸ª IDï¼Œè¶…è¿‡éœ€åˆ†æ‰¹è°ƒç”¨
- Feign è¶…æ—¶é…ç½®ï¼šè¿æ¥è¶…æ—¶ 3 ç§’ï¼Œè¯»å–è¶…æ—¶ 5 ç§’
- æ¨èç®—æ³•åŸºäºç”¨æˆ·å½“å‰ä½ç½®ï¼Œéœ€å‰ç«¯ä¼ é€’ç»çº¬åº¦å‚æ•°
- æ‰€æœ‰èšåˆæ¥å£è¿”å›æ ¼å¼éµå¾ª `R<T>` (code, message, data)
