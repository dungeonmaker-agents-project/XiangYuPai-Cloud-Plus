# XyPai-App-BFF App ç«¯ä¸šåŠ¡ç¼–æ’æœåŠ¡å¿«é€Ÿç†è§£

## âš ï¸ é‡è¦å˜æ›´ (2025-11-25)

### åŒ…ç»“æ„å·²ç»Ÿä¸€
**é—®é¢˜**: ä¹‹å‰å­˜åœ¨åŒ…ç»“æ„ä¸ä¸€è‡´å¯¼è‡´ `NoClassDefFoundError`
- âŒ æ—§åŒ…: `org.dromara.aggregation.*`
- âœ… æ–°åŒ…: `org.dromara.appbff.*` (å·²ç»Ÿä¸€)

**å·²ä¿®å¤**:
- âœ… ä¸»å¯åŠ¨ç±»: `org.dromara.appbff.XyPaiAppBffApplication`
- âœ… æ‰€æœ‰ Controller/Service/DTO/VO åœ¨ `org.dromara.appbff` åŒ…ä¸‹
- âœ… æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å·²è¿ç§»åˆ° `org.dromara.appbff` å’Œ `org.dromara.appbff.pages` åŒ…ä¸‹
- âœ… pom.xml å·²é…ç½® `<mainClass>org.dromara.appbff.XyPaiAppBffApplication</mainClass>`

**å½±å“**: å¦‚æœä¹‹å‰æ„å»ºå¤±è´¥æˆ–æµ‹è¯•å¤±è´¥ï¼Œç°åœ¨åº”è¯¥æ­£å¸¸äº†

---

## ğŸ“Œ æ ¸å¿ƒå®šä½
å‘å¨±æ‹ App ç«¯ä¸šåŠ¡ç¼–æ’æœåŠ¡ï¼ˆBackend For Frontendï¼‰ï¼ŒåŸºäº Spring Cloud å¾®æœåŠ¡æ¶æ„ã€‚

**æœ¬æ¨¡å—èŒè´£**ï¼šä¸º App å®¢æˆ·ç«¯æä¾›èšåˆæ¥å£ï¼Œä¸ç›´æ¥è¿æ¥æ•°æ®åº“ï¼Œé€šè¿‡ Dubbo RPC è°ƒç”¨å¤šä¸ªé¢†åŸŸæœåŠ¡ï¼ˆuserã€contentã€order ç­‰ï¼‰ï¼Œå®ç°ä¸šåŠ¡ç¼–æ’ã€æ•°æ®èšåˆã€æ¨èç®—æ³•ã€‚

## ğŸ¯ ä¸»è¦åŠŸèƒ½
- **é¦–é¡µ Feed æµ**ï¼šç”¨æˆ·æ¨èï¼ˆçº¿ä¸Š/çº¿ä¸‹ï¼‰+ è·ç¦»è®¡ç®— + æŠ€èƒ½åŒ¹é…
- **å‘ç°é¡µèšåˆ**ï¼šå†…å®¹æµ + ç”¨æˆ·ä¿¡æ¯ + äº’åŠ¨æ•°æ®ä¸€æ¬¡è¿”å›
- **ç”¨æˆ·ä¸»é¡µèšåˆ**ï¼šç”¨æˆ·èµ„æ–™ + åŠ¨æ€åˆ—è¡¨ + æŠ€èƒ½ + ç²‰ä¸æ•°ç»Ÿè®¡
- **è®¢å•è¯¦æƒ…èšåˆ**ï¼šè®¢å• + ç”¨æˆ·ä¿¡æ¯ + æ”¯ä»˜ä¿¡æ¯å®Œæ•´è¿”å›
- **æ¨èç®—æ³•**ï¼šåŸºäºè·ç¦»ã€æŠ€èƒ½ã€æ´»è·ƒåº¦çš„ç”¨æˆ·åŒ¹é…å¼•æ“

## ğŸ—ï¸ æŠ€æœ¯æ ˆ
```
Spring Boot 3.x + Dubbo RPC + Nacos
Redis (æ¨èç»“æœç¼“å­˜ + ç”¨æˆ·ç”»åƒç¼“å­˜)
```

## ğŸ“ æ ¸å¿ƒç›®å½•ç»“æ„
```
xypai-app-bff/
â””â”€â”€ src/main/java/org/dromara/appbff/    # âœ… ç»Ÿä¸€åŒ…å
    â”œâ”€â”€ XyPaiAppBffApplication.java      # âœ… Spring Boot å¯åŠ¨ç±»
    â”œâ”€â”€ controller/
    â”‚   â”œâ”€â”€ HomeFeedController.java      # âœ… é¦–é¡µ Feed æµï¼ˆMockï¼‰
    â”‚   â”œâ”€â”€ HomeFilterController.java    # âœ… é¦–é¡µç­›é€‰ï¼ˆMockï¼‰
    â”‚   â”œâ”€â”€ HomeLimitedTimeController.java # âœ… é™æ—¶ä¸“äº«ï¼ˆRPCçœŸå®æ•°æ®ï¼‰
    â”‚   â”œâ”€â”€ HomeSearchController.java    # âœ… æœç´¢åˆå§‹åŒ–ï¼ˆMockï¼‰
    â”‚   â””â”€â”€ SearchResultController.java  # âœ… æœç´¢ç»“æœï¼ˆMockï¼‰
    â”œâ”€â”€ service/
    â”‚   â”œâ”€â”€ HomeFilterService.java       # ç­›é€‰æœåŠ¡æ¥å£
    â”‚   â”œâ”€â”€ HomeLimitedTimeService.java  # é™æ—¶ä¸“äº«æœåŠ¡æ¥å£
    â”‚   â”œâ”€â”€ HomeSearchService.java       # æœç´¢æœåŠ¡æ¥å£
    â”‚   â””â”€â”€ impl/
    â”‚       â”œâ”€â”€ HomeFilterServiceImpl.java
    â”‚       â”œâ”€â”€ HomeLimitedTimeServiceImpl.java  # âœ… çœŸå®RPCè°ƒç”¨
    â”‚       â”œâ”€â”€ HomeSearchServiceImpl.java
    â”‚       â””â”€â”€ HomeSearchResultServiceImpl.java
    â””â”€â”€ domain/
        â”œâ”€â”€ dto/
        â”‚   â”œâ”€â”€ HomeFeedQueryDTO.java
        â”‚   â”œâ”€â”€ FilterApplyDTO.java      # ç­›é€‰è¯·æ±‚DTOï¼ˆå«å†…éƒ¨ç±»FilterCriteriaï¼‰
        â”‚   â”œâ”€â”€ LimitedTimeQueryDTO.java
        â”‚   â”œâ”€â”€ SearchQueryDTO.java
        â”‚   â””â”€â”€ SearchHistoryDeleteDTO.java
        â””â”€â”€ vo/
            â”œâ”€â”€ UserCardVO.java
            â”œâ”€â”€ FilterConfigVO.java
            â”œâ”€â”€ FilterResultVO.java
            â”œâ”€â”€ LimitedTimeResultVO.java
            â”œâ”€â”€ LimitedTimeUserVO.java
            â”œâ”€â”€ SearchInitVO.java
            â””â”€â”€ SearchResultVO.java

â””â”€â”€ src/test/java/org/dromara/appbff/    # âœ… æµ‹è¯•æ–‡ä»¶å·²è¿ç§»
    â”œâ”€â”€ AppHomeFeedTest.java
    â””â”€â”€ pages/
        â”œâ”€â”€ Page02_FilterTest.java       # âœ… ç­›é€‰é¡µé¢é›†æˆæµ‹è¯•
        â”œâ”€â”€ Page02_PublishFeedTest.java
        â”œâ”€â”€ Page03_FeedDetailTest.java   # âœ… åŠ¨æ€è¯¦æƒ…é›†æˆæµ‹è¯•
        â”œâ”€â”€ Page05_LimitedTimeTest.java  # âœ… é™æ—¶ä¸“äº«é›†æˆæµ‹è¯•
        â”œâ”€â”€ Page06_SearchTest.java       # âœ… æœç´¢é¡µé¢é›†æˆæµ‹è¯•
        â””â”€â”€ Page07_SearchResultsTest.java # âœ… æœç´¢ç»“æœé›†æˆæµ‹è¯•
```

## ğŸ”‘ æ ¸å¿ƒæ¥å£
| æ¥å£ | è¯´æ˜ | èšåˆæ•°æ®æ¥æº | çŠ¶æ€ |
|------|------|-------------|------|
| `GET /api/home/feed` | é¦–é¡µç”¨æˆ·æ¨èæµ | user(ç”¨æˆ·åˆ—è¡¨) + content(åŠ¨æ€æ•°) | âœ… Mock |
| `GET /api/home/filter/config` | è·å–ç­›é€‰é…ç½® | - (Mockæ•°æ®) | âœ… Mock |
| `POST /api/home/filter/apply` | åº”ç”¨ç­›é€‰æ¡ä»¶ | - (Mockæ•°æ®) | âœ… Mock |
| `GET /api/home/limited-time/list` | **é™æ—¶ä¸“äº«åˆ—è¡¨** | xypai-user (users+skills+stats) | âœ… **RPCçœŸå®æ•°æ®** |
| `GET /api/home/search/init` | æœç´¢é¡µåˆå§‹åŒ– | - (Mockæ•°æ®) | âœ… Mock |
| `GET /api/home/search/suggest` | æœç´¢è”æƒ³ | - (Mockæ•°æ®) | âœ… Mock |
| `GET /api/v1/search/all` | ç»¼åˆæœç´¢ | - (Mockæ•°æ®) | âœ… Mock |
| `GET /api/v1/search/user` | ç”¨æˆ·æœç´¢ | - (Mockæ•°æ®) | âœ… Mock |
| `GET /api/discovery` | å‘ç°é¡µå†…å®¹æµ | content(åŠ¨æ€) + user(ä½œè€…) + interaction(äº’åŠ¨) | â³ å¾…å®ç° |
| `GET /api/profile/{userId}/full` | ç”¨æˆ·ä¸»é¡µå®Œæ•´ä¿¡æ¯ | user(èµ„æ–™+æŠ€èƒ½+ç»Ÿè®¡) + content(åŠ¨æ€) | â³ å¾…å®ç° |
| `GET /api/order/detail/{orderId}` | è®¢å•è¯¦æƒ… | order(è®¢å•) + user(ç”¨æˆ·) + payment(æ”¯ä»˜) | â³ å¾…å®ç° |

## ğŸ›ï¸ å¾®æœåŠ¡æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   App å®¢æˆ·ç«¯     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ REST API
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway (9300) â”‚  â† ç»Ÿä¸€ç½‘å…³ï¼ˆè®¤è¯ã€è·¯ç”±ï¼‰
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                 â†“             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ xypai-   â”‚  â”‚ xypai-   â”‚  â”‚ xypai-   â”‚
â”‚ app-bff  â”‚  â”‚ auth     â”‚  â”‚ content  â”‚
â”‚ (9400)   â”‚  â”‚ (8200)   â”‚  â”‚ (9403)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ Dubbo RPC
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ xypai-   â”‚  é¢†åŸŸæœåŠ¡å±‚
â”‚ user     â”‚  (æ•°æ®åº“è®¿é—®)
â”‚ (9401)   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚
   â”Œâ”€â–¼â”€â”€â”€â”
   â”‚MySQLâ”‚  åŸºç¡€è®¾æ–½å±‚
   â”‚user â”‚
   â””â”€â”€â”€â”€â”€â”˜
```

## ğŸ”¥ æŠ€æœ¯äº®ç‚¹
1. **BFF æ¨¡å¼**ï¼šå‰ç«¯ä¸€æ¬¡è¯·æ±‚è·å–å®Œæ•´æ•°æ®ï¼Œé¿å…å¤šæ¬¡ HTTP è°ƒç”¨ï¼ˆä» 5 æ¬¡ â†’ 1 æ¬¡ï¼‰
2. **å¾®æœåŠ¡è§£è€¦**ï¼šèšåˆå±‚ä¸ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œæ‰€æœ‰æ•°æ®é€šè¿‡ Dubbo RPC è·å–
3. **æ‰¹é‡ä¼˜åŒ–**ï¼šä¸€æ¬¡è¯·æ±‚èšåˆå¤šæœåŠ¡æ•°æ®ï¼Œå‡å°‘å‰ç«¯ HTTP è°ƒç”¨æ¬¡æ•°
4. **æ•°æ®è£å‰ª**ï¼šæ ¹æ®åœºæ™¯è¿”å›å¿…è¦å­—æ®µï¼Œé¦–é¡µç”¨æˆ·å¡ç‰‡ä»…è¿”å› 8 ä¸ªå­—æ®µï¼ˆå®Œæ•´ç”¨æˆ·æœ‰ 33 ä¸ªå­—æ®µï¼‰
5. **ç¼“å­˜ä¼˜åŒ–**ï¼šçƒ­é—¨æ¨èç»“æœç¼“å­˜ 5 åˆ†é’Ÿï¼Œç”¨æˆ·ç”»åƒç¼“å­˜ 30 åˆ†é’Ÿ
6. **åŒ…ç»“æ„ç»Ÿä¸€**ï¼šå•ä¸€åŒ…ç»“æ„ `org.dromara.appbff`ï¼Œæ¸…æ™°æ˜äº†

## ğŸ“¦ ä¾èµ–å…³ç³»
```
xypai-app-bff (æœ¬æ¨¡å—)
  â†“ Dubbo RPC è°ƒç”¨
â”œâ”€ xypai-user (ç”¨æˆ·æœåŠ¡)
â”‚   â”œâ”€ RemoteAppUserService.queryLimitedTimeUsers()  # âœ… å·²å®ç°
â”‚   â”œâ”€ getUserById(Long userId)                      # â³ å¾…å®ç°
â”‚   â”œâ”€ getUserProfiles(List<Long> userIds)           # â³ å¾…å®ç°
â”‚   â””â”€ getUserStats(Long userId)                     # â³ å¾…å®ç°
â”‚
â”œâ”€ xypai-content (å†…å®¹æœåŠ¡)                           # â³ å¾…å®ç°
â”‚   â”œâ”€ getFeedList(FeedQueryDTO)
â”‚   â”œâ”€ getUserActivities(List<Long> userIds)
â”‚   â””â”€ getInteractionStats(Long feedId)
â”‚
â”œâ”€ xypai-order (è®¢å•æœåŠ¡)                             # â³ å¾…å®ç°
â”‚   â”œâ”€ getOrderDetail(Long orderId)
â”‚   â””â”€ getUserOrders(Long userId)
â”‚
â””â”€ xypai-payment (æ”¯ä»˜æœåŠ¡)                           # â³ å¾…å®ç°
    â””â”€ getPaymentInfo(Long orderId)
```

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### å‰ç½®æ¡ä»¶
```bash
# 1. ç¡®ä¿ä¾èµ–æœåŠ¡å·²å¯åŠ¨
#    - Nacosï¼ˆæœåŠ¡æ³¨å†Œä¸­å¿ƒï¼‰
#    - Redisï¼ˆç¼“å­˜ï¼‰
#    - MySQLï¼ˆxypai_user æ•°æ®åº“ï¼‰
#    - xypai-user (9401) - ç”¨æˆ·æœåŠ¡
#    - xypai-content (9403) - å†…å®¹æœåŠ¡ï¼ˆå¯é€‰ï¼‰
#    - Gateway (9300) - ç»Ÿä¸€ç½‘å…³
```

### å¯åŠ¨æœåŠ¡
```bash
# æ–¹å¼1: IDE å¯åŠ¨ (æ¨è)
# ä¸»ç±»: org.dromara.appbff.XyPaiAppBffApplication

# æ–¹å¼2: å‘½ä»¤è¡Œå¯åŠ¨
cd xypai-aggregation/xypai-app-bff
mvn clean package -DskipTests
java -jar target/xypai-app-bff.jar

# é»˜è®¤ç«¯å£ï¼š9400
# Swagger UI: http://localhost:9400/doc.html
```

### éªŒè¯æœåŠ¡
```bash
# æ£€æŸ¥ Nacos æ³¨å†Œ
# http://localhost:8848/nacos (nacos/nacos)

# æµ‹è¯•æ¥å£ï¼ˆéœ€å…ˆç™»å½•è·å– tokenï¼‰
GET http://localhost:9400/api/home/limited-time/list
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### å…³é”®è¦ç‚¹
- âš ï¸ **åŒ…ç»“æ„ç»Ÿä¸€**: ä½¿ç”¨ `org.dromara.appbff.XyPaiAppBffApplication` å¯åŠ¨ç±»
- âš ï¸ **é‡æ–°æ„å»º**: åŒ…ç»“æ„å˜æ›´åå¿…é¡»æ‰§è¡Œ `mvn clean compile`
- **æ— æ•°æ®åº“è¿æ¥**ï¼šæœ¬æ¨¡å—æ˜¯çº¯ä¸šåŠ¡ç¼–æ’å±‚ï¼Œæ‰€æœ‰æ•°æ®é€šè¿‡ Dubbo RPC è°ƒç”¨é¢†åŸŸæœåŠ¡è·å–
- **ä¾èµ–æœåŠ¡å¯åŠ¨é¡ºåº**ï¼šå¿…é¡»å…ˆå¯åŠ¨é¢†åŸŸæœåŠ¡ï¼ˆuserã€contentã€orderã€paymentï¼‰ï¼Œå¦åˆ™ RPC è°ƒç”¨å¤±è´¥
- **ç»Ÿä¸€è¿”å›æ ¼å¼**ï¼šæ‰€æœ‰æ¥å£è¿”å› `R<T>` (code, message, data)

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
- èšåˆæ¥å£åº”ç¼“å­˜é«˜é¢‘æ•°æ®ï¼ˆå¦‚é¦–é¡µæ¨èåˆ—è¡¨ï¼‰
- æ¨èç®—æ³•å¯ä½¿ç”¨ Redis ç¼“å­˜ç”¨æˆ·ç”»åƒ
- æ‰¹é‡ RPC è°ƒç”¨æ—¶æ³¨æ„è¶…æ—¶æ§åˆ¶ï¼ˆé»˜è®¤ 3 ç§’ï¼‰

### å¼€å‘è§„èŒƒ
- BFF å±‚ä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œé¢†åŸŸæœåŠ¡ä¸“æ³¨æ•°æ® CRUD
- èŒè´£æ¸…æ™°åˆ†ç¦»ï¼Œé¿å…ä»£ç è€¦åˆ
- ä½¿ç”¨ Mock æ•°æ®æ—¶æ³¨æ˜ TODOï¼Œä¾¿äºåç»­æ›¿æ¢

---

**æœ€åæ›´æ–°**: 2025-11-25
**çŠ¶æ€**: âœ… åŒ…ç»“æ„ç»Ÿä¸€ + Page 05 RPC é›†æˆå®Œæˆ + æµ‹è¯•æ–‡ä»¶å·²è¿ç§»
**ä¸‹ä¸€æ­¥**: å…¶ä»–é¡µé¢ RPC çœŸå®æ•°æ®é›†æˆ
