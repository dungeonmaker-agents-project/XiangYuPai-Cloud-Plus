# é›†æˆæ–‡æ¡£ 02: ç»„å±€ä¸­å¿ƒæ¨¡å— (Page08-10)

> ç‰ˆæœ¬: v1.0.0 | åˆ›å»ºæ—¥æœŸ: 2025-11-26 | ä¼˜å…ˆçº§: â­â­â­â­ (é«˜)

---

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

### ä¸šåŠ¡æè¿°
ç»„å±€ä¸­å¿ƒæ˜¯å‘å¨±æ‹å¹³å°çš„ç¤¾äº¤æ ¸å¿ƒåŠŸèƒ½ï¼Œå…è®¸ç”¨æˆ·å‘èµ·å’Œå‚ä¸çº¿ä¸‹/çº¿ä¸Šæ´»åŠ¨ã€‚åŒ…æ‹¬æ´»åŠ¨å‘å¸ƒã€æŠ¥åã€å®¡æ ¸ã€æ”¯ä»˜ç­‰å®Œæ•´ä¸šåŠ¡æµç¨‹ã€‚

### å¯¹åº”å‰ç«¯é¡µé¢
| é¡µé¢ | è·¯ç”± | åŠŸèƒ½ |
|------|------|------|
| Page08 | `/activity/list` | ç»„å±€åˆ—è¡¨ï¼ˆç­›é€‰/æ’åºï¼‰ |
| Page09 | `/activity/detail/:id` | ç»„å±€è¯¦æƒ…ï¼ˆæŠ¥å/æ”¯ä»˜ï¼‰ |
| Page10 | `/activity/publish` | å‘å¸ƒç»„å±€ï¼ˆè¡¨å•å¡«å†™ï¼‰ |

### å½“å‰çŠ¶æ€
- **BFF å±‚**: âœ… Mock å®ç°å®Œæˆ
- **RPC æ¥å£**: â³ å¾…å®šä¹‰
- **é¢†åŸŸæœåŠ¡**: â³ å¾…å®ç°
- **æ•°æ®åº“è¡¨**: â³ å¾…åˆ›å»º

---

## ğŸ¯ é›†æˆç›®æ ‡

å°† `ActivityServiceImpl` ä¸­çš„ Mock æ•°æ®æ›¿æ¢ä¸ºçœŸå®çš„ Dubbo RPC è°ƒç”¨ã€‚éœ€è¦åšå‡ºæ¶æ„å†³ç­–ï¼šå°†æ´»åŠ¨åŠŸèƒ½ä½œä¸º `xypai-content` æœåŠ¡çš„æ‰©å±•ï¼Œè¿˜æ˜¯æ–°å»ºç‹¬ç«‹çš„ `xypai-activity` æœåŠ¡ã€‚

---

## ğŸ—ï¸ æ¶æ„æ–¹æ¡ˆé€‰æ‹©

### æ–¹æ¡ˆ A: æ‰©å±• xypai-content æœåŠ¡ï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**:
- å¤ç”¨ç°æœ‰æœåŠ¡æ¶æ„ï¼Œå‡å°‘è¿ç»´æˆæœ¬
- æ´»åŠ¨ä¸ Feed å†…å®¹æœ‰å¤©ç„¶å…³è”ï¼ˆå‘å¸ƒæ´»åŠ¨å¯åŒæ—¶ç”Ÿæˆ Feedï¼‰
- å…±äº«ç”¨æˆ·ç»Ÿè®¡ã€å†…å®¹å®¡æ ¸ç­‰åŸºç¡€èƒ½åŠ›

**ç¼ºç‚¹**:
- content æœåŠ¡èŒè´£å˜é‡
- ä¸šåŠ¡è€¦åˆåº¦å¢åŠ 

**å®æ–½æ–¹å¼**:
```
xypai_content æ•°æ®åº“æ–°å¢è¡¨:
â”œâ”€â”€ activity              # ç»„å±€æ´»åŠ¨ä¸»è¡¨
â”œâ”€â”€ activity_participant  # æ´»åŠ¨å‚ä¸è€…è¡¨
â”œâ”€â”€ activity_type         # æ´»åŠ¨ç±»å‹é…ç½®è¡¨
â””â”€â”€ activity_payment      # æ´»åŠ¨è´¹ç”¨è®°å½•è¡¨

ruoyi-api/xypai-api-content æ–°å¢:
â””â”€â”€ RemoteActivityService.java  # æ´»åŠ¨ RPC æ¥å£
```

### æ–¹æ¡ˆ B: æ–°å»º xypai-activity æœåŠ¡

**ä¼˜ç‚¹**:
- ä¸šåŠ¡éš”ç¦»æ¸…æ™°
- ç‹¬ç«‹æ‰©å±•å’Œéƒ¨ç½²
- æœªæ¥å¯ç‹¬ç«‹ä¼˜åŒ–

**ç¼ºç‚¹**:
- éœ€è¦æ–°å»ºæœåŠ¡æ¨¡å—
- å¢åŠ è¿ç»´å¤æ‚åº¦
- éœ€è¦è·¨æœåŠ¡è°ƒç”¨ç”¨æˆ·ä¿¡æ¯

**å®æ–½æ–¹å¼**:
```
æ–°æœåŠ¡: xypai-activity (ç«¯å£: 9408)
æ–°æ•°æ®åº“: xypai_activity
â”œâ”€â”€ activity              # ç»„å±€æ´»åŠ¨ä¸»è¡¨
â”œâ”€â”€ activity_participant  # æ´»åŠ¨å‚ä¸è€…è¡¨
â”œâ”€â”€ activity_type         # æ´»åŠ¨ç±»å‹é…ç½®è¡¨
â””â”€â”€ activity_payment      # æ´»åŠ¨è´¹ç”¨è®°å½•è¡¨

ruoyi-api æ–°å¢æ¨¡å—:
â””â”€â”€ xypai-api-activity    # æ´»åŠ¨ API å®šä¹‰
```

---

## ğŸ“ æ¶‰åŠæ–‡ä»¶æ¸…å•

### BFF å±‚ (xypai-app-bff)

| æ–‡ä»¶è·¯å¾„ | ç±»å‹ | è¯´æ˜ | é›†æˆæ—¶ä¿®æ”¹ |
|----------|------|------|-----------|
| `controller/ActivityController.java` | Controller | REST æ¥å£ (9ä¸ª) | âŒ æ— éœ€ä¿®æ”¹ |
| `service/ActivityService.java` | Interface | æœåŠ¡æ¥å£ | âŒ æ— éœ€ä¿®æ”¹ |
| `service/impl/ActivityServiceImpl.java` | Impl | æœåŠ¡å®ç° | âœ… **æ ¸å¿ƒä¿®æ”¹** |
| `domain/dto/ActivityListQueryDTO.java` | DTO | åˆ—è¡¨æŸ¥è¯¢ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/dto/ActivityPublishDTO.java` | DTO | å‘å¸ƒè¯·æ±‚ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/dto/ActivityRegisterDTO.java` | DTO | æŠ¥åè¯·æ±‚ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/dto/ActivityRegisterCancelDTO.java` | DTO | å–æ¶ˆæŠ¥å | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/dto/ActivityPayDTO.java` | DTO | æ”¯ä»˜è¯·æ±‚ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityCardVO.java` | VO | æ´»åŠ¨å¡ç‰‡ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityListResultVO.java` | VO | åˆ—è¡¨ç»“æœ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityDetailVO.java` | VO | æ´»åŠ¨è¯¦æƒ… | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityPublishConfigVO.java` | VO | å‘å¸ƒé…ç½® | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityRegisterResultVO.java` | VO | æŠ¥åç»“æœ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityPublishResultVO.java` | VO | å‘å¸ƒç»“æœ | âŒ æ— éœ€ä¿®æ”¹ |
| `domain/vo/ActivityPayResultVO.java` | VO | æ”¯ä»˜ç»“æœ | âŒ æ— éœ€ä¿®æ”¹ |

### RPC API å±‚ (æ–°å»º)

| æ–‡ä»¶è·¯å¾„ | ç±»å‹ | è¯´æ˜ | æ“ä½œ |
|----------|------|------|------|
| `RemoteActivityService.java` | Interface | RPC æ¥å£ | âœ… **æ–°å»º** |
| `domain/dto/ActivityQueryDto.java` | DTO | æŸ¥è¯¢è¯·æ±‚ | âœ… **æ–°å»º** |
| `domain/dto/ActivityPublishDto.java` | DTO | å‘å¸ƒè¯·æ±‚ | âœ… **æ–°å»º** |
| `domain/dto/ActivityRegisterDto.java` | DTO | æŠ¥åè¯·æ±‚ | âœ… **æ–°å»º** |
| `domain/vo/ActivityVo.java` | VO | æ´»åŠ¨ä¿¡æ¯ | âœ… **æ–°å»º** |
| `domain/vo/ActivityDetailVo.java` | VO | æ´»åŠ¨è¯¦æƒ… | âœ… **æ–°å»º** |
| `domain/vo/ActivityPageResult.java` | VO | åˆ†é¡µç»“æœ | âœ… **æ–°å»º** |
| `domain/vo/ActivityPublishConfigVo.java` | VO | å‘å¸ƒé…ç½® | âœ… **æ–°å»º** |
| `domain/vo/ActivityRegisterResultVo.java` | VO | æŠ¥åç»“æœ | âœ… **æ–°å»º** |
| `domain/vo/ActivityPublishResultVo.java` | VO | å‘å¸ƒç»“æœ | âœ… **æ–°å»º** |

### é¢†åŸŸæœåŠ¡å±‚ (æ–°å»ºæˆ–æ‰©å±•)

| æ–‡ä»¶è·¯å¾„ | ç±»å‹ | è¯´æ˜ | æ“ä½œ |
|----------|------|------|------|
| `service/impl/RemoteActivityServiceImpl.java` | Impl | RPC å®ç° | âœ… **æ–°å»º** |
| `service/ActivityDomainService.java` | Service | é¢†åŸŸæœåŠ¡ | âœ… **æ–°å»º** |
| `mapper/ActivityMapper.java` | Mapper | æ´»åŠ¨æ•°æ®è®¿é—® | âœ… **æ–°å»º** |
| `mapper/ActivityParticipantMapper.java` | Mapper | å‚ä¸è€…æ•°æ®è®¿é—® | âœ… **æ–°å»º** |
| `domain/Activity.java` | Entity | æ´»åŠ¨å®ä½“ | âœ… **æ–°å»º** |
| `domain/ActivityParticipant.java` | Entity | å‚ä¸è€…å®ä½“ | âœ… **æ–°å»º** |

---

## ğŸ—„ï¸ Step 1: æ•°æ®åº“è®¾è®¡

### 1.1 æ´»åŠ¨ä¸»è¡¨ (activity)

```sql
CREATE TABLE `activity` (
    `activity_id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æ´»åŠ¨ID',
    `user_id` BIGINT NOT NULL COMMENT 'å‘èµ·äººç”¨æˆ·ID',
    `activity_type` VARCHAR(50) NOT NULL COMMENT 'æ´»åŠ¨ç±»å‹: explore, billiards, ktv, dining, sports, etc.',
    `title` VARCHAR(200) NOT NULL COMMENT 'æ´»åŠ¨æ ‡é¢˜',
    `description` TEXT COMMENT 'æ´»åŠ¨æè¿°',
    `cover_image_url` VARCHAR(500) COMMENT 'å°é¢å›¾ç‰‡URL',
    `images` JSON COMMENT 'æ´»åŠ¨å›¾ç‰‡åˆ—è¡¨(JSONæ•°ç»„)',

    -- æ—¶é—´ä¿¡æ¯
    `start_time` DATETIME NOT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    `end_time` DATETIME COMMENT 'ç»“æŸæ—¶é—´',
    `registration_deadline` DATETIME COMMENT 'æŠ¥åæˆªæ­¢æ—¶é—´',

    -- åœ°ç‚¹ä¿¡æ¯
    `location_name` VARCHAR(200) COMMENT 'åœ°ç‚¹åç§°',
    `location_address` VARCHAR(500) COMMENT 'è¯¦ç»†åœ°å€',
    `longitude` DECIMAL(10, 7) COMMENT 'ç»åº¦',
    `latitude` DECIMAL(10, 7) COMMENT 'çº¬åº¦',
    `city_code` VARCHAR(20) COMMENT 'åŸå¸‚ä»£ç ',
    `district_code` VARCHAR(20) COMMENT 'åŒºåŸŸä»£ç ',

    -- äººæ•°ä¸è´¹ç”¨
    `min_members` INT DEFAULT 2 COMMENT 'æœ€å°‘äººæ•°',
    `max_members` INT DEFAULT 10 COMMENT 'æœ€å¤§äººæ•°',
    `current_members` INT DEFAULT 0 COMMENT 'å½“å‰æŠ¥åäººæ•°',
    `gender_limit` VARCHAR(20) DEFAULT 'all' COMMENT 'æ€§åˆ«é™åˆ¶: all, male, female',
    `is_paid` TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦æ”¶è´¹',
    `fee` DECIMAL(10, 2) DEFAULT 0 COMMENT 'è´¹ç”¨é‡‘é¢',
    `fee_description` VARCHAR(200) COMMENT 'è´¹ç”¨è¯´æ˜',

    -- çŠ¶æ€
    `status` VARCHAR(20) DEFAULT 'recruiting' COMMENT 'çŠ¶æ€: recruiting(æ‹›å‹Ÿä¸­), full(å·²æ»¡), ongoing(è¿›è¡Œä¸­), ended(å·²ç»“æŸ), cancelled(å·²å–æ¶ˆ)',
    `need_approval` TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦éœ€è¦å®¡æ ¸æŠ¥å',

    -- å…¶ä»–
    `tags` JSON COMMENT 'æ´»åŠ¨æ ‡ç­¾(JSONæ•°ç»„)',
    `contact_info` VARCHAR(200) COMMENT 'è”ç³»æ–¹å¼',
    `view_count` INT DEFAULT 0 COMMENT 'æµè§ˆé‡',
    `share_count` INT DEFAULT 0 COMMENT 'åˆ†äº«æ¬¡æ•°',

    -- ç³»ç»Ÿå­—æ®µ
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `del_flag` TINYINT(1) DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',

    PRIMARY KEY (`activity_id`),
    INDEX `idx_user_id` (`user_id`),
    INDEX `idx_activity_type` (`activity_type`),
    INDEX `idx_status` (`status`),
    INDEX `idx_start_time` (`start_time`),
    INDEX `idx_city_code` (`city_code`),
    INDEX `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç»„å±€æ´»åŠ¨è¡¨';
```

### 1.2 å‚ä¸è€…è¡¨ (activity_participant)

```sql
CREATE TABLE `activity_participant` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `activity_id` BIGINT NOT NULL COMMENT 'æ´»åŠ¨ID',
    `user_id` BIGINT NOT NULL COMMENT 'å‚ä¸è€…ç”¨æˆ·ID',
    `status` VARCHAR(20) DEFAULT 'pending' COMMENT 'çŠ¶æ€: pending(å¾…å®¡æ ¸), approved(å·²é€šè¿‡), rejected(å·²æ‹’ç»), cancelled(å·²å–æ¶ˆ)',
    `message` VARCHAR(500) COMMENT 'æŠ¥åç•™è¨€',
    `reject_reason` VARCHAR(200) COMMENT 'æ‹’ç»åŸå› ',
    `register_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'æŠ¥åæ—¶é—´',
    `approve_time` DATETIME COMMENT 'å®¡æ ¸æ—¶é—´',
    `is_paid` TINYINT(1) DEFAULT 0 COMMENT 'æ˜¯å¦å·²æ”¯ä»˜',
    `payment_id` BIGINT COMMENT 'æ”¯ä»˜è®°å½•ID',
    `payment_time` DATETIME COMMENT 'æ”¯ä»˜æ—¶é—´',

    -- ç³»ç»Ÿå­—æ®µ
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    `update_time` DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    `del_flag` TINYINT(1) DEFAULT 0 COMMENT 'åˆ é™¤æ ‡è®°',

    PRIMARY KEY (`id`),
    UNIQUE INDEX `uk_activity_user` (`activity_id`, `user_id`),
    INDEX `idx_activity_id` (`activity_id`),
    INDEX `idx_user_id` (`user_id`),
    INDEX `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ´»åŠ¨å‚ä¸è€…è¡¨';
```

### 1.3 æ´»åŠ¨ç±»å‹é…ç½®è¡¨ (activity_type)

```sql
CREATE TABLE `activity_type` (
    `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
    `type_code` VARCHAR(50) NOT NULL COMMENT 'ç±»å‹ä»£ç ',
    `type_name` VARCHAR(100) NOT NULL COMMENT 'ç±»å‹åç§°',
    `icon` VARCHAR(200) COMMENT 'å›¾æ ‡URL',
    `sort_order` INT DEFAULT 0 COMMENT 'æ’åºå·',
    `is_active` TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦å¯ç”¨',
    `create_time` DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',

    PRIMARY KEY (`id`),
    UNIQUE INDEX `uk_type_code` (`type_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ´»åŠ¨ç±»å‹é…ç½®è¡¨';

-- åˆå§‹æ•°æ®
INSERT INTO `activity_type` (`type_code`, `type_name`, `icon`, `sort_order`) VALUES
('explore', 'æ¢åº—', '/icons/explore.png', 1),
('billiards', 'å°çƒ', '/icons/billiards.png', 2),
('ktv', 'KTV', '/icons/ktv.png', 3),
('dining', 'èšé¤', '/icons/dining.png', 4),
('sports', 'è¿åŠ¨', '/icons/sports.png', 5),
('games', 'æ¡Œæ¸¸', '/icons/games.png', 6),
('movies', 'ç”µå½±', '/icons/movies.png', 7),
('outdoor', 'æˆ·å¤–', '/icons/outdoor.png', 8),
('other', 'å…¶ä»–', '/icons/other.png', 99);
```

---

## ğŸ”§ Step 2: RPC æ¥å£å®šä¹‰

### 2.1 æ–°å¢ DTO ç±»

**æ–‡ä»¶**: `ruoyi-api/xypai-api-activity/src/main/java/org/dromara/activity/api/domain/dto/ActivityQueryDto.java`

```java
package org.dromara.activity.api.domain.dto;

import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.util.List;

/**
 * æ´»åŠ¨æŸ¥è¯¢ DTO
 */
@Data
public class ActivityQueryDto implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    /** é¡µç  */
    private Integer pageNum = 1;

    /** æ¯é¡µæ•°é‡ */
    private Integer pageSize = 10;

    /** æ’åºæ–¹å¼: smart_recommend, newest, distance_asc, start_time_asc */
    private String sortBy;

    /** æ€§åˆ«ç­›é€‰: all, male, female */
    private String gender;

    /** äººæ•°ç­›é€‰: all, 2-4, 5-10, 10+ */
    private String memberCount;

    /** æ´»åŠ¨ç±»å‹åˆ—è¡¨ */
    private List<String> activityTypes;

    /** åŸå¸‚ä»£ç  */
    private String cityCode;

    /** åŒºåŸŸä»£ç  */
    private String districtCode;

    /** å½“å‰ç”¨æˆ·ID (ç”¨äºè®¡ç®—è·ç¦»ã€æ¨èç­‰) */
    private Long currentUserId;

    /** å½“å‰ç”¨æˆ·ç»åº¦ */
    private Double longitude;

    /** å½“å‰ç”¨æˆ·çº¬åº¦ */
    private Double latitude;
}
```

**æ–‡ä»¶**: `ruoyi-api/xypai-api-activity/src/main/java/org/dromara/activity/api/domain/dto/ActivityPublishDto.java`

```java
package org.dromara.activity.api.domain.dto;

import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;

/**
 * æ´»åŠ¨å‘å¸ƒ DTO
 */
@Data
public class ActivityPublishDto implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    /** æ´»åŠ¨ç±»å‹ */
    private String activityType;

    /** æ´»åŠ¨æ ‡é¢˜ */
    private String title;

    /** æ´»åŠ¨æè¿° */
    private String description;

    /** å°é¢å›¾ç‰‡URL */
    private String coverImageUrl;

    /** æ´»åŠ¨å›¾ç‰‡åˆ—è¡¨ */
    private List<String> imageUrls;

    /** å¼€å§‹æ—¶é—´ */
    private LocalDateTime startTime;

    /** ç»“æŸæ—¶é—´ */
    private LocalDateTime endTime;

    /** æŠ¥åæˆªæ­¢æ—¶é—´ */
    private LocalDateTime registrationDeadline;

    /** åœ°ç‚¹åç§° */
    private String locationName;

    /** è¯¦ç»†åœ°å€ */
    private String locationAddress;

    /** ç»åº¦ */
    private BigDecimal longitude;

    /** çº¬åº¦ */
    private BigDecimal latitude;

    /** åŸå¸‚ä»£ç  */
    private String cityCode;

    /** åŒºåŸŸä»£ç  */
    private String districtCode;

    /** æœ€å°‘äººæ•° */
    private Integer minMembers;

    /** æœ€å¤§äººæ•° */
    private Integer maxMembers;

    /** æ€§åˆ«é™åˆ¶ */
    private String genderLimit;

    /** æ˜¯å¦æ”¶è´¹ */
    private Boolean isPaid;

    /** è´¹ç”¨é‡‘é¢ */
    private BigDecimal fee;

    /** è´¹ç”¨è¯´æ˜ */
    private String feeDescription;

    /** æ˜¯å¦éœ€è¦å®¡æ ¸æŠ¥å */
    private Boolean needApproval;

    /** æ´»åŠ¨æ ‡ç­¾ */
    private List<String> tags;

    /** è”ç³»æ–¹å¼ */
    private String contactInfo;
}
```

### 2.2 æ–°å¢ VO ç±»

**æ–‡ä»¶**: `ruoyi-api/xypai-api-activity/src/main/java/org/dromara/activity/api/domain/vo/ActivityVo.java`

```java
package org.dromara.activity.api.domain.vo;

import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.math.BigDecimal;
import java.time.LocalDateTime;
import java.util.List;

/**
 * æ´»åŠ¨ä¿¡æ¯ VO (åˆ—è¡¨ç”¨)
 */
@Data
public class ActivityVo implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    private Long activityId;
    private String activityType;
    private String activityTypeName;
    private String title;
    private String coverImageUrl;

    // æ—¶é—´
    private LocalDateTime startTime;
    private LocalDateTime endTime;

    // åœ°ç‚¹
    private String locationName;
    private String city;
    private String district;

    // äººæ•°
    private Integer minMembers;
    private Integer maxMembers;
    private Integer currentMembers;
    private String genderLimit;

    // è´¹ç”¨
    private Boolean isPaid;
    private BigDecimal fee;

    // çŠ¶æ€
    private String status;
    private Boolean needApproval;

    // å‘èµ·äºº
    private Long organizerUserId;
    private String organizerNickname;
    private String organizerAvatar;
    private Boolean organizerIsVerified;

    // è·ç¦»(ç”±è°ƒç”¨æ–¹è®¡ç®—æˆ–ä¼ å…¥)
    private Integer distance;

    // æ ‡ç­¾
    private List<String> tags;

    // åˆ›å»ºæ—¶é—´
    private LocalDateTime createTime;
}
```

**æ–‡ä»¶**: `ruoyi-api/xypai-api-activity/src/main/java/org/dromara/activity/api/domain/vo/ActivityPageResult.java`

```java
package org.dromara.activity.api.domain.vo;

import lombok.Data;
import java.io.Serial;
import java.io.Serializable;
import java.util.List;

/**
 * æ´»åŠ¨åˆ†é¡µç»“æœ
 */
@Data
public class ActivityPageResult implements Serializable {

    @Serial
    private static final long serialVersionUID = 1L;

    /** æ•°æ®åˆ—è¡¨ */
    private List<ActivityVo> list;

    /** æ€»æ•° */
    private Long total;

    /** æ˜¯å¦æœ‰æ›´å¤š */
    private Boolean hasMore;

    /** ç­›é€‰é…ç½® */
    private FilterConfig filters;

    @Data
    public static class FilterConfig implements Serializable {
        @Serial
        private static final long serialVersionUID = 1L;

        private List<SortOption> sortOptions;
        private List<FilterOption> genderOptions;
        private List<FilterOption> memberCountOptions;
        private List<ActivityTypeOption> activityTypes;
    }

    @Data
    public static class SortOption implements Serializable {
        @Serial
        private static final long serialVersionUID = 1L;
        private String value;
        private String label;
    }

    @Data
    public static class FilterOption implements Serializable {
        @Serial
        private static final long serialVersionUID = 1L;
        private String value;
        private String label;
    }

    @Data
    public static class ActivityTypeOption implements Serializable {
        @Serial
        private static final long serialVersionUID = 1L;
        private String value;
        private String label;
        private String icon;
    }
}
```

### 2.3 å®šä¹‰ RemoteActivityService æ¥å£

**æ–‡ä»¶**: `ruoyi-api/xypai-api-activity/src/main/java/org/dromara/activity/api/RemoteActivityService.java`

```java
package org.dromara.activity.api;

import org.dromara.activity.api.domain.dto.*;
import org.dromara.activity.api.domain.vo.*;

/**
 * æ´»åŠ¨è¿œç¨‹æœåŠ¡æ¥å£
 */
public interface RemoteActivityService {

    // ========== åˆ—è¡¨ä¸è¯¦æƒ… ==========

    /**
     * åˆ†é¡µæŸ¥è¯¢æ´»åŠ¨åˆ—è¡¨
     *
     * @param queryDto æŸ¥è¯¢æ¡ä»¶
     * @return åˆ†é¡µç»“æœ
     */
    ActivityPageResult queryActivityList(ActivityQueryDto queryDto);

    /**
     * è·å–æ´»åŠ¨è¯¦æƒ…
     *
     * @param activityId æ´»åŠ¨ID
     * @param userId å½“å‰ç”¨æˆ·ID
     * @return æ´»åŠ¨è¯¦æƒ…
     */
    ActivityDetailVo getActivityDetail(Long activityId, Long userId);

    // ========== å‘å¸ƒ ==========

    /**
     * è·å–å‘å¸ƒé…ç½®
     *
     * @param userId ç”¨æˆ·ID
     * @return é…ç½®ä¿¡æ¯
     */
    ActivityPublishConfigVo getPublishConfig(Long userId);

    /**
     * å‘å¸ƒæ´»åŠ¨
     *
     * @param publishDto å‘å¸ƒä¿¡æ¯
     * @param userId ç”¨æˆ·ID
     * @return å‘å¸ƒç»“æœ
     */
    ActivityPublishResultVo publishActivity(ActivityPublishDto publishDto, Long userId);

    // ========== æŠ¥å ==========

    /**
     * æŠ¥åæ´»åŠ¨
     *
     * @param activityId æ´»åŠ¨ID
     * @param userId ç”¨æˆ·ID
     * @param message æŠ¥åç•™è¨€
     * @return æŠ¥åç»“æœ
     */
    ActivityRegisterResultVo registerActivity(Long activityId, Long userId, String message);

    /**
     * å–æ¶ˆæŠ¥å
     *
     * @param activityId æ´»åŠ¨ID
     * @param userId ç”¨æˆ·ID
     * @param reason å–æ¶ˆåŸå› 
     * @return æ˜¯å¦æˆåŠŸ
     */
    Boolean cancelRegistration(Long activityId, Long userId, String reason);

    // ========== å‘èµ·äººæ“ä½œ ==========

    /**
     * å®¡æ ¸æŠ¥å
     *
     * @param activityId æ´»åŠ¨ID
     * @param participantId å‚ä¸è€…ç”¨æˆ·ID
     * @param approved æ˜¯å¦é€šè¿‡
     * @param userId å‘èµ·äººç”¨æˆ·ID
     * @return æ˜¯å¦æˆåŠŸ
     */
    Boolean approveRegistration(Long activityId, Long participantId, Boolean approved, Long userId);

    /**
     * å–æ¶ˆæ´»åŠ¨
     *
     * @param activityId æ´»åŠ¨ID
     * @param reason å–æ¶ˆåŸå› 
     * @param userId å‘èµ·äººç”¨æˆ·ID
     * @return æ˜¯å¦æˆåŠŸ
     */
    Boolean cancelActivity(Long activityId, String reason, Long userId);
}
```

---

## ğŸ”§ Step 3: é¢†åŸŸæœåŠ¡å®ç°

### 3.1 Mapper æ¥å£

**æ–‡ä»¶**: `xypai-modules/xypai-activity/src/main/java/org/dromara/activity/mapper/ActivityMapper.java`

```java
package org.dromara.activity.mapper;

import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import org.apache.ibatis.annotations.Param;
import org.dromara.activity.domain.Activity;
import org.dromara.activity.api.domain.dto.ActivityQueryDto;
import org.dromara.activity.api.domain.vo.ActivityVo;
import org.dromara.activity.api.domain.vo.ActivityDetailVo;

/**
 * æ´»åŠ¨ Mapper
 */
public interface ActivityMapper extends BaseMapper<Activity> {

    /**
     * åˆ†é¡µæŸ¥è¯¢æ´»åŠ¨åˆ—è¡¨
     */
    Page<ActivityVo> selectActivityPage(
        @Param("page") Page<?> page,
        @Param("query") ActivityQueryDto query
    );

    /**
     * è·å–æ´»åŠ¨è¯¦æƒ…
     */
    ActivityDetailVo selectActivityDetail(
        @Param("activityId") Long activityId,
        @Param("userId") Long userId
    );

    /**
     * æ›´æ–°æŠ¥åäººæ•°
     */
    int updateCurrentMembers(@Param("activityId") Long activityId);

    /**
     * æ›´æ–°æ´»åŠ¨çŠ¶æ€
     */
    int updateStatus(
        @Param("activityId") Long activityId,
        @Param("status") String status
    );
}
```

### 3.2 Service å®ç°

**æ–‡ä»¶**: `xypai-modules/xypai-activity/src/main/java/org/dromara/activity/service/remote/RemoteActivityServiceImpl.java`

```java
package org.dromara.activity.service.remote;

import com.baomidou.mybatisplus.extension.plugins.pagination.Page;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.dubbo.config.annotation.DubboService;
import org.dromara.activity.api.RemoteActivityService;
import org.dromara.activity.api.domain.dto.*;
import org.dromara.activity.api.domain.vo.*;
import org.dromara.activity.domain.Activity;
import org.dromara.activity.domain.ActivityParticipant;
import org.dromara.activity.mapper.ActivityMapper;
import org.dromara.activity.mapper.ActivityParticipantMapper;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import java.time.LocalDateTime;

/**
 * æ´»åŠ¨è¿œç¨‹æœåŠ¡å®ç°
 */
@Slf4j
@Service
@DubboService
@RequiredArgsConstructor
public class RemoteActivityServiceImpl implements RemoteActivityService {

    private final ActivityMapper activityMapper;
    private final ActivityParticipantMapper participantMapper;
    private final ActivityTypeMapper activityTypeMapper;

    @Override
    public ActivityPageResult queryActivityList(ActivityQueryDto queryDto) {
        log.info("æŸ¥è¯¢æ´»åŠ¨åˆ—è¡¨: {}", queryDto);

        // 1. åˆ†é¡µæŸ¥è¯¢
        Page<ActivityVo> page = activityMapper.selectActivityPage(
            new Page<>(queryDto.getPageNum(), queryDto.getPageSize()),
            queryDto
        );

        // 2. æ„å»ºç­›é€‰é…ç½®
        FilterConfig filters = buildFilterConfig();

        // 3. ç»„è£…ç»“æœ
        ActivityPageResult result = new ActivityPageResult();
        result.setList(page.getRecords());
        result.setTotal(page.getTotal());
        result.setHasMore(page.hasNext());
        result.setFilters(filters);

        return result;
    }

    @Override
    public ActivityDetailVo getActivityDetail(Long activityId, Long userId) {
        log.info("è·å–æ´»åŠ¨è¯¦æƒ…: activityId={}, userId={}", activityId, userId);
        return activityMapper.selectActivityDetail(activityId, userId);
    }

    @Override
    public ActivityPublishConfigVo getPublishConfig(Long userId) {
        log.info("è·å–å‘å¸ƒé…ç½®: userId={}", userId);

        ActivityPublishConfigVo config = new ActivityPublishConfigVo();
        // åŠ è½½æ´»åŠ¨ç±»å‹ã€è´¹ç”¨è§„åˆ™ç­‰é…ç½®
        config.setActivityTypes(activityTypeMapper.selectActiveTypes());
        // ... å…¶ä»–é…ç½®
        return config;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public ActivityPublishResultVo publishActivity(ActivityPublishDto publishDto, Long userId) {
        log.info("å‘å¸ƒæ´»åŠ¨: userId={}, dto={}", userId, publishDto);

        // 1. åˆ›å»ºæ´»åŠ¨å®ä½“
        Activity activity = convertToEntity(publishDto);
        activity.setUserId(userId);
        activity.setStatus("recruiting");
        activity.setCreateTime(LocalDateTime.now());

        // 2. ä¿å­˜æ´»åŠ¨
        activityMapper.insert(activity);

        // 3. è¿”å›ç»“æœ
        ActivityPublishResultVo result = new ActivityPublishResultVo();
        result.setSuccess(true);
        result.setActivityId(activity.getActivityId());
        return result;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public ActivityRegisterResultVo registerActivity(Long activityId, Long userId, String message) {
        log.info("æŠ¥åæ´»åŠ¨: activityId={}, userId={}, message={}", activityId, userId, message);

        ActivityRegisterResultVo result = new ActivityRegisterResultVo();

        // 1. æ£€æŸ¥æ´»åŠ¨çŠ¶æ€
        Activity activity = activityMapper.selectById(activityId);
        if (activity == null) {
            result.setSuccess(false);
            result.setStatusMessage("æ´»åŠ¨ä¸å­˜åœ¨");
            return result;
        }
        if (!"recruiting".equals(activity.getStatus())) {
            result.setSuccess(false);
            result.setStatusMessage("æ´»åŠ¨ä¸åœ¨æ‹›å‹Ÿä¸­");
            return result;
        }

        // 2. æ£€æŸ¥æ˜¯å¦å·²æŠ¥å
        ActivityParticipant existing = participantMapper.selectByActivityAndUser(activityId, userId);
        if (existing != null) {
            result.setSuccess(false);
            result.setStatusMessage("æ‚¨å·²æŠ¥å");
            return result;
        }

        // 3. åˆ›å»ºæŠ¥åè®°å½•
        ActivityParticipant participant = new ActivityParticipant();
        participant.setActivityId(activityId);
        participant.setUserId(userId);
        participant.setMessage(message);
        participant.setStatus(activity.getNeedApproval() ? "pending" : "approved");
        participant.setRegisterTime(LocalDateTime.now());

        participantMapper.insert(participant);

        // 4. æ›´æ–°æŠ¥åäººæ•°
        if (!activity.getNeedApproval()) {
            activityMapper.updateCurrentMembers(activityId);
        }

        result.setSuccess(true);
        result.setStatus(participant.getStatus());
        result.setStatusMessage(activity.getNeedApproval() ? "æŠ¥åæˆåŠŸï¼Œç­‰å¾…å‘èµ·äººå®¡æ ¸" : "æŠ¥åæˆåŠŸ");
        return result;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Boolean cancelRegistration(Long activityId, Long userId, String reason) {
        log.info("å–æ¶ˆæŠ¥å: activityId={}, userId={}, reason={}", activityId, userId, reason);

        // 1. æŸ¥æ‰¾æŠ¥åè®°å½•
        ActivityParticipant participant = participantMapper.selectByActivityAndUser(activityId, userId);
        if (participant == null) {
            return false;
        }

        // 2. æ›´æ–°çŠ¶æ€
        participant.setStatus("cancelled");
        participantMapper.updateById(participant);

        // 3. æ›´æ–°æŠ¥åäººæ•°
        activityMapper.updateCurrentMembers(activityId);

        return true;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Boolean approveRegistration(Long activityId, Long participantId, Boolean approved, Long userId) {
        log.info("å®¡æ ¸æŠ¥å: activityId={}, participantId={}, approved={}, userId={}",
            activityId, participantId, approved, userId);

        // 1. éªŒè¯å‘èµ·äººèº«ä»½
        Activity activity = activityMapper.selectById(activityId);
        if (activity == null || !activity.getUserId().equals(userId)) {
            return false;
        }

        // 2. æŸ¥æ‰¾æŠ¥åè®°å½•
        ActivityParticipant participant = participantMapper.selectByActivityAndUser(activityId, participantId);
        if (participant == null || !"pending".equals(participant.getStatus())) {
            return false;
        }

        // 3. æ›´æ–°çŠ¶æ€
        participant.setStatus(approved ? "approved" : "rejected");
        participant.setApproveTime(LocalDateTime.now());
        participantMapper.updateById(participant);

        // 4. æ›´æ–°æŠ¥åäººæ•°
        if (approved) {
            activityMapper.updateCurrentMembers(activityId);
        }

        return true;
    }

    @Override
    @Transactional(rollbackFor = Exception.class)
    public Boolean cancelActivity(Long activityId, String reason, Long userId) {
        log.info("å–æ¶ˆæ´»åŠ¨: activityId={}, reason={}, userId={}", activityId, reason, userId);

        // 1. éªŒè¯å‘èµ·äººèº«ä»½
        Activity activity = activityMapper.selectById(activityId);
        if (activity == null || !activity.getUserId().equals(userId)) {
            return false;
        }

        // 2. æ›´æ–°çŠ¶æ€
        activityMapper.updateStatus(activityId, "cancelled");

        // 3. TODO: é€šçŸ¥å·²æŠ¥åç”¨æˆ·ã€é€€æ¬¾ç­‰

        return true;
    }

    // ========== ç§æœ‰æ–¹æ³• ==========

    private FilterConfig buildFilterConfig() {
        // æ„å»ºç­›é€‰é…ç½®ï¼ˆå¯ç¼“å­˜ï¼‰
        FilterConfig config = new FilterConfig();
        // ... æ„å»ºæ’åºé€‰é¡¹ã€ç­›é€‰é€‰é¡¹ç­‰
        return config;
    }

    private Activity convertToEntity(ActivityPublishDto dto) {
        Activity activity = new Activity();
        // ... å­—æ®µæ˜ å°„
        return activity;
    }
}
```

---

## ğŸ”§ Step 4: BFF å±‚é›†æˆ

### 4.1 ä¿®æ”¹ ActivityServiceImpl

**æ–‡ä»¶**: `xypai-aggregation/xypai-app-bff/src/main/java/org/dromara/appbff/service/impl/ActivityServiceImpl.java`

```java
package org.dromara.appbff.service.impl;

import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.apache.dubbo.config.annotation.DubboReference;
import org.dromara.activity.api.RemoteActivityService;
import org.dromara.activity.api.domain.dto.*;
import org.dromara.activity.api.domain.vo.*;
import org.dromara.appbff.domain.dto.*;
import org.dromara.appbff.domain.vo.*;
import org.dromara.appbff.service.ActivityService;
import org.dromara.appuser.api.RemoteAppUserService;
import org.dromara.payment.api.RemotePaymentService;
import org.springframework.stereotype.Service;

/**
 * ç»„å±€æ´»åŠ¨æœåŠ¡å®ç°ç±»ï¼ˆRPC ç‰ˆæœ¬ï¼‰
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class ActivityServiceImpl implements ActivityService {

    @DubboReference
    private RemoteActivityService remoteActivityService;

    @DubboReference
    private RemoteAppUserService remoteAppUserService;

    @DubboReference
    private RemotePaymentService remotePaymentService;

    @Override
    public ActivityListResultVO queryActivityList(ActivityListQueryDTO queryDTO, Long userId) {
        log.info("æŸ¥è¯¢æ´»åŠ¨åˆ—è¡¨: queryDTO={}, userId={}", queryDTO, userId);

        // 1. è½¬æ¢è¯·æ±‚ DTO
        ActivityQueryDto rpcQuery = convertToRpcQuery(queryDTO, userId);

        // 2. è°ƒç”¨ RPC æ¥å£
        ActivityPageResult rpcResult = remoteActivityService.queryActivityList(rpcQuery);

        // 3. è½¬æ¢å“åº” VO
        return convertToListResult(rpcResult);
    }

    @Override
    public ActivityDetailVO getActivityDetail(Long activityId, Long userId) {
        log.info("è·å–æ´»åŠ¨è¯¦æƒ…: activityId={}, userId={}", activityId, userId);

        ActivityDetailVo rpcResult = remoteActivityService.getActivityDetail(activityId, userId);
        return convertToDetailVO(rpcResult);
    }

    @Override
    public ActivityRegisterResultVO registerActivity(ActivityRegisterDTO registerDTO, Long userId) {
        log.info("æŠ¥åæ´»åŠ¨: registerDTO={}, userId={}", registerDTO, userId);

        ActivityRegisterResultVo rpcResult = remoteActivityService.registerActivity(
            registerDTO.getActivityId(),
            userId,
            registerDTO.getMessage()
        );
        return convertToRegisterResult(rpcResult);
    }

    @Override
    public Boolean cancelActivityRegistration(ActivityRegisterCancelDTO cancelDTO, Long userId) {
        log.info("å–æ¶ˆæŠ¥å: cancelDTO={}, userId={}", cancelDTO, userId);

        return remoteActivityService.cancelRegistration(
            cancelDTO.getActivityId(),
            userId,
            cancelDTO.getReason()
        );
    }

    @Override
    public ActivityPublishConfigVO getPublishConfig(Long userId) {
        log.info("è·å–å‘å¸ƒé…ç½®: userId={}", userId);

        ActivityPublishConfigVo rpcResult = remoteActivityService.getPublishConfig(userId);
        return convertToPublishConfig(rpcResult);
    }

    @Override
    public ActivityPublishResultVO publishActivity(ActivityPublishDTO publishDTO, Long userId) {
        log.info("å‘å¸ƒæ´»åŠ¨: publishDTO={}, userId={}", publishDTO, userId);

        ActivityPublishDto rpcDto = convertToRpcPublishDto(publishDTO);
        ActivityPublishResultVo rpcResult = remoteActivityService.publishActivity(rpcDto, userId);
        return convertToPublishResult(rpcResult);
    }

    @Override
    public ActivityPayResultVO payActivity(ActivityPayDTO payDTO, Long userId) {
        log.info("æ”¯ä»˜æ´»åŠ¨è´¹ç”¨: payDTO={}, userId={}", payDTO, userId);

        // è°ƒç”¨æ”¯ä»˜æœåŠ¡
        // PaymentResult paymentResult = remotePaymentService.createPayment(...)
        // TODO: å®ç°æ”¯ä»˜é€»è¾‘

        ActivityPayResultVO result = new ActivityPayResultVO();
        result.setSuccess(true);
        result.setStatusMessage("æ”¯ä»˜æˆåŠŸ");
        return result;
    }

    @Override
    public Boolean approveRegistration(Long activityId, Long participantId, Boolean approved, Long userId) {
        log.info("å®¡æ ¸æŠ¥å: activityId={}, participantId={}, approved={}, userId={}",
            activityId, participantId, approved, userId);

        return remoteActivityService.approveRegistration(activityId, participantId, approved, userId);
    }

    @Override
    public Boolean cancelActivity(Long activityId, String reason, Long userId) {
        log.info("å–æ¶ˆæ´»åŠ¨: activityId={}, reason={}, userId={}", activityId, reason, userId);

        return remoteActivityService.cancelActivity(activityId, reason, userId);
    }

    // ========== è½¬æ¢æ–¹æ³• ==========

    private ActivityQueryDto convertToRpcQuery(ActivityListQueryDTO dto, Long userId) {
        ActivityQueryDto query = new ActivityQueryDto();
        query.setPageNum(dto.getPageNum());
        query.setPageSize(dto.getPageSize());
        query.setSortBy(dto.getSortBy());
        query.setGender(dto.getGender());
        query.setMemberCount(dto.getMemberCount());
        query.setActivityTypes(dto.getActivityType());
        query.setCityCode(dto.getCityCode());
        query.setDistrictCode(dto.getDistrictCode());
        query.setCurrentUserId(userId);
        return query;
    }

    private ActivityListResultVO convertToListResult(ActivityPageResult rpc) {
        ActivityListResultVO result = new ActivityListResultVO();
        // ... å­—æ®µæ˜ å°„
        return result;
    }

    private ActivityDetailVO convertToDetailVO(ActivityDetailVo rpc) {
        ActivityDetailVO result = new ActivityDetailVO();
        // ... å­—æ®µæ˜ å°„
        return result;
    }

    private ActivityRegisterResultVO convertToRegisterResult(ActivityRegisterResultVo rpc) {
        ActivityRegisterResultVO result = new ActivityRegisterResultVO();
        result.setSuccess(rpc.getSuccess());
        result.setStatus(rpc.getStatus());
        result.setStatusMessage(rpc.getStatusMessage());
        return result;
    }

    private ActivityPublishConfigVO convertToPublishConfig(ActivityPublishConfigVo rpc) {
        ActivityPublishConfigVO result = new ActivityPublishConfigVO();
        // ... å­—æ®µæ˜ å°„
        return result;
    }

    private ActivityPublishDto convertToRpcPublishDto(ActivityPublishDTO dto) {
        ActivityPublishDto rpcDto = new ActivityPublishDto();
        // ... å­—æ®µæ˜ å°„
        return rpcDto;
    }

    private ActivityPublishResultVO convertToPublishResult(ActivityPublishResultVo rpc) {
        ActivityPublishResultVO result = new ActivityPublishResultVO();
        result.setSuccess(rpc.getSuccess());
        result.setActivityId(rpc.getActivityId());
        return result;
    }
}
```

---

## ğŸ§ª Step 5: æµ‹è¯•éªŒè¯

### 5.1 å•å…ƒæµ‹è¯•

```java
@SpringBootTest
public class ActivityServiceImplTest {

    @Autowired
    private ActivityService activityService;

    @Test
    void testQueryActivityList() {
        ActivityListQueryDTO query = new ActivityListQueryDTO();
        query.setPageNum(1);
        query.setPageSize(10);

        ActivityListResultVO result = activityService.queryActivityList(query, 1L);

        assertNotNull(result);
        assertNotNull(result.getList());
    }

    @Test
    void testPublishActivity() {
        ActivityPublishDTO dto = new ActivityPublishDTO();
        dto.setActivityType("explore");
        dto.setTitle("å‘¨æœ«æ¢åº—æ´»åŠ¨");
        dto.setDescription("ä¸€èµ·å»æ¢ç´¢æ–°å¼€çš„ç½‘çº¢é¤å…");
        dto.setMinMembers(3);
        dto.setMaxMembers(6);

        ActivityPublishResultVO result = activityService.publishActivity(dto, 1L);

        assertTrue(result.getSuccess());
        assertNotNull(result.getActivityId());
    }
}
```

### 5.2 é›†æˆæµ‹è¯•

ä½¿ç”¨å·²æœ‰çš„æµ‹è¯•æ–‡ä»¶:
- `Page08_ActivityListTest.java`
- `Page09_ActivityDetailTest.java`
- `Page10_ActivityPublishTest.java`

---

## ğŸ“Š æ•°æ®æ˜ å°„å…³ç³»

### BFF VO â†’ RPC VO å­—æ®µæ˜ å°„

| BFF å­—æ®µ | RPC å­—æ®µ | è¯´æ˜ |
|----------|----------|------|
| `ActivityCardVO.activityId` | `ActivityVo.activityId` | æ´»åŠ¨ID |
| `ActivityCardVO.organizer.userId` | `ActivityVo.organizerUserId` | å‘èµ·äººID |
| `ActivityCardVO.organizer.nickname` | `ActivityVo.organizerNickname` | å‘èµ·äººæ˜µç§° |
| `ActivityDetailVO.participants` | éœ€å•ç‹¬æŸ¥è¯¢ | å‚ä¸è€…åˆ—è¡¨ |

---

## ğŸ”— è·¨æœåŠ¡ä¾èµ–

### éœ€è¦è°ƒç”¨çš„å…¶ä»–æœåŠ¡

| æœåŠ¡ | æ¥å£ | ç”¨é€” |
|------|------|------|
| `RemoteAppUserService` | `getUserInfo(userId)` | è·å–ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ |
| `RemoteAppUserService` | `batchGetUsersByIds(userIds)` | æ‰¹é‡è·å–å‚ä¸è€…ä¿¡æ¯ |
| `RemotePaymentService` | `createPayment(...)` | åˆ›å»ºæ”¯ä»˜è®¢å• |
| `RemotePaymentService` | `refund(...)` | å–æ¶ˆæ´»åŠ¨æ—¶é€€æ¬¾ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **äº‹åŠ¡ç®¡ç†**: æŠ¥åã€å®¡æ ¸ç­‰æ“ä½œéœ€è¦ä½¿ç”¨äº‹åŠ¡
2. **å¹¶å‘æ§åˆ¶**: æŠ¥åäººæ•°é™åˆ¶éœ€è¦è€ƒè™‘å¹¶å‘åœºæ™¯ï¼ˆä¹è§‚é”/åˆ†å¸ƒå¼é”ï¼‰
3. **çŠ¶æ€æœº**: æ´»åŠ¨çŠ¶æ€å˜åŒ–éœ€è¦éµå¾ªçŠ¶æ€æœºè§„åˆ™
4. **æ¶ˆæ¯é€šçŸ¥**: æŠ¥åå®¡æ ¸ç»“æœéœ€è¦é€šçŸ¥ç”¨æˆ·ï¼ˆå¯ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
5. **æ”¯ä»˜é›†æˆ**: éœ€è¦ä¸ xypai-payment æœåŠ¡è”åŠ¨
6. **é€€æ¬¾é€»è¾‘**: å–æ¶ˆæ´»åŠ¨æ—¶éœ€è¦å¤„ç†å·²æ”¯ä»˜ç”¨æˆ·çš„é€€æ¬¾

---

## ğŸ“… é¢„è®¡å·¥æ—¶

| ä»»åŠ¡ | å·¥æ—¶ | è´Ÿè´£äºº |
|------|------|--------|
| æ•°æ®åº“è®¾è®¡ä¸å»ºè¡¨ | 0.5 å¤© | |
| RPC æ¥å£å®šä¹‰ (DTO/VO) | 1 å¤© | |
| é¢†åŸŸæœåŠ¡å®ç° | 2 å¤© | |
| BFF å±‚é›†æˆ | 0.5 å¤© | |
| æ”¯ä»˜è”åŠ¨ï¼ˆå¯åç»­ï¼‰ | 1 å¤© | |
| æµ‹è¯•éªŒè¯ | 1 å¤© | |
| **æ€»è®¡** | **6 å¤©** | |

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [é›†æˆæ–‡æ¡£-01-æŠ€èƒ½æœåŠ¡æ¨¡å—](./é›†æˆæ–‡æ¡£-01-æŠ€èƒ½æœåŠ¡æ¨¡å—.md)
- [BFF å¿«é€Ÿç†è§£](../å¿«é€Ÿç†è§£.md)
- [RPC é›†æˆè®¡åˆ’](../RPCé›†æˆè®¡åˆ’.md)
- [å‰ç«¯æ–‡æ¡£: 08-ç»„å±€åˆ—è¡¨é¡µé¢.md](å‰ç«¯æ–‡æ¡£é“¾æ¥)
- [å‰ç«¯æ–‡æ¡£: 09-ç»„å±€è¯¦æƒ…é¡µé¢.md](å‰ç«¯æ–‡æ¡£é“¾æ¥)
- [å‰ç«¯æ–‡æ¡£: 10-å‘å¸ƒç»„å±€é¡µé¢.md](å‰ç«¯æ–‡æ¡£é“¾æ¥)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0
**æœ€åæ›´æ–°**: 2025-11-26
