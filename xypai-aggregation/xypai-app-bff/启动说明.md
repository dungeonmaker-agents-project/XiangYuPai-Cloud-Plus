# XyPai App BFF æœåŠ¡å¯åŠ¨è¯´æ˜

## ğŸ“‹ å‰ç½®æ¡ä»¶

### 1. åŸºç¡€è®¾æ–½æœåŠ¡ï¼ˆå¿…é¡»å…ˆå¯åŠ¨ï¼‰
- **Nacos**: http://localhost:8848/nacos (æ³¨å†Œä¸­å¿ƒ + é…ç½®ä¸­å¿ƒ)
- **Redis**: localhost:6379 (ç¼“å­˜æœåŠ¡)
- **Gateway**: localhost:8080 (API ç½‘å…³)

### 2. ä¾èµ–çš„é¢†åŸŸæœåŠ¡ï¼ˆå¯é€‰ï¼Œç”¨äº RPC è°ƒç”¨ï¼‰
- **xypai-auth**: localhost:9211 (è®¤è¯æœåŠ¡)
- **xypai-user**: localhost:9401 (ç”¨æˆ·æœåŠ¡)
- **xypai-content**: localhost:9403 (å†…å®¹æœåŠ¡)

**æ³¨æ„**: å½“å‰ç‰ˆæœ¬è¿”å› Mock æ•°æ®ï¼Œæš‚ä¸ä¾èµ–é¢†åŸŸæœåŠ¡ã€‚ç­‰å¾…å®ç° RPC è°ƒç”¨åæ‰éœ€è¦å¯åŠ¨é¢†åŸŸæœåŠ¡ã€‚

## ğŸš€ å¯åŠ¨æ–¹å¼

### æ–¹å¼ä¸€ï¼šMaven å‘½ä»¤å¯åŠ¨ï¼ˆæ¨èç”¨äºå¼€å‘ï¼‰

```bash
# è¿›å…¥æ¨¡å—ç›®å½•
cd E:\Users\Administrator\Documents\GitHub\RuoYi-Cloud-Plus\xypai-aggregation\xypai-app-bff

# ç¼–è¯‘å¹¶å¯åŠ¨
mvn clean spring-boot:run -Dspring-boot.run.profiles=dev

# æˆ–è€…æŒ‡å®šå…¶ä»–ç¯å¢ƒ
mvn spring-boot:run -Dspring-boot.run.profiles=test
```

### æ–¹å¼äºŒï¼šæ‰“åŒ…åå¯åŠ¨ï¼ˆæ¨èç”¨äºç”Ÿäº§ï¼‰

```bash
# 1. ç¼–è¯‘æ‰“åŒ…
cd E:\Users\Administrator\Documents\GitHub\RuoYi-Cloud-Plus\xypai-aggregation\xypai-app-bff
mvn clean package -DskipTests

# 2. å¯åŠ¨ JAR åŒ…
java -jar target/xypai-app-bff.jar --spring.profiles.active=dev

# 3. åå°å¯åŠ¨ï¼ˆLinux/Macï¼‰
nohup java -jar target/xypai-app-bff.jar --spring.profiles.active=dev > logs/app.log 2>&1 &
```

### æ–¹å¼ä¸‰ï¼šIDE å¯åŠ¨ï¼ˆæ¨èç”¨äºè°ƒè¯•ï¼‰

1. æ‰“å¼€ IntelliJ IDEA
2. æ‰¾åˆ° `XyPaiAppBffApplication.java`
3. å³é”® â†’ Run 'XyPaiAppBffApplication'
4. æˆ–è€…ç‚¹å‡»ç±»å·¦ä¾§çš„ç»¿è‰²è¿è¡ŒæŒ‰é’®

**ç¯å¢ƒå˜é‡é…ç½®**ï¼š
- VM Options: `-Dspring.profiles.active=dev`
- Program arguments: `--server.port=9400`

## âœ… éªŒè¯æœåŠ¡å¯åŠ¨æˆåŠŸ

### 1. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
å¯åŠ¨æˆåŠŸåï¼Œåº”è¯¥çœ‹åˆ°ï¼š
```
(â™¥â— â€¿â— )ãƒã‚™  XyPai App BFFèšåˆæœåŠ¡å¯åŠ¨æˆåŠŸ   áƒš(Â´Ú¡`áƒš)ã‚™
```

### 2. æ£€æŸ¥ Nacos æ³¨å†Œ
è®¿é—®: http://localhost:8848/nacos
- ç”¨æˆ·å/å¯†ç : nacos/nacos
- åœ¨ "æœåŠ¡ç®¡ç†" â†’ "æœåŠ¡åˆ—è¡¨" ä¸­æŸ¥çœ‹ `xypai-app-bff` æ˜¯å¦æ³¨å†ŒæˆåŠŸ

### 3. æµ‹è¯• API æ¥å£

#### é€šè¿‡ Gateway è®¿é—®ï¼ˆæ¨èï¼‰
```bash
# è·å–é¦–é¡µæ¨èåˆ—è¡¨ï¼ˆéœ€è¦å…ˆç™»å½•è·å– tokenï¼‰
curl -X GET "http://localhost:8080/xypai-app-bff/api/home/feed?type=online&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

#### ç›´æ¥è®¿é—®æœåŠ¡ï¼ˆå¼€å‘è°ƒè¯•ï¼‰
```bash
# è·å–é¦–é¡µæ¨èåˆ—è¡¨
curl -X GET "http://localhost:9400/api/home/feed?type=online&pageNum=1&pageSize=10" \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### 4. è®¿é—® API æ–‡æ¡£
- Swagger UI: http://localhost:9400/doc.html
- æˆ–é€šè¿‡ Gateway: http://localhost:8080/xypai-app-bff/doc.html

## ğŸ§ª è¿è¡Œé›†æˆæµ‹è¯•

```bash
# ç¡®ä¿æœåŠ¡å·²å¯åŠ¨ï¼Œç„¶åè¿è¡Œæµ‹è¯•
cd E:\Users\Administrator\Documents\GitHub\RuoYi-Cloud-Plus\xypai-aggregation\xypai-app-bff
mvn test -Dtest=AppHomeFeedTest

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. ç«¯å£è¢«å ç”¨
```
Error: Port 9400 is already in use
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æ˜¯å¦å·²ç»å¯åŠ¨äº†è¯¥æœåŠ¡
- æˆ–ä¿®æ”¹ `application.yml` ä¸­çš„ç«¯å£å·

### 2. Nacos è¿æ¥å¤±è´¥
```
Error: Unable to connect to Nacos server
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ Nacos å·²å¯åŠ¨: http://localhost:8848/nacos
- æ£€æŸ¥ `application.yml` ä¸­çš„ Nacos é…ç½®æ˜¯å¦æ­£ç¡®

### 3. Redis è¿æ¥å¤±è´¥
```
Error: Unable to connect to Redis
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿ Redis å·²å¯åŠ¨: `redis-server`
- æ£€æŸ¥ Redis é…ç½®ï¼ˆé»˜è®¤ localhost:6379ï¼‰

### 4. æ•°æ®åº“è¿æ¥é”™è¯¯
```
Error: DataSource configuration required
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
è¿™æ˜¯æ­£å¸¸çš„ï¼BFF æœåŠ¡ä¸åº”è¯¥è¿æ¥æ•°æ®åº“ã€‚
- ç¡®è®¤ `XyPaiAppBffApplication.java` ä¸­å·²æ’é™¤æ•°æ®æºé…ç½®ï¼š
  ```java
  @SpringBootApplication(exclude = {DataSourceAutoConfiguration.class})
  ```

## ğŸ“Š æœåŠ¡å¥åº·æ£€æŸ¥

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# é€šè¿‡ Actuatorï¼ˆå¦‚æœå·²å¯ç”¨ï¼‰
curl http://localhost:9400/actuator/health

# é¢„æœŸè¿”å›
{
  "status": "UP"
}
```

## ğŸ”„ çƒ­éƒ¨ç½²ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

å¦‚æœä½¿ç”¨ IDEA å¼€å‘ï¼š
1. æ·»åŠ  `spring-boot-devtools` ä¾èµ–ï¼ˆå·²åŒ…å«åœ¨ pom.xmlï¼‰
2. IDEA è®¾ç½®ï¼š
   - Settings â†’ Build, Execution, Deployment â†’ Compiler
   - å‹¾é€‰ "Build project automatically"
3. ä¿®æ”¹ä»£ç åè‡ªåŠ¨é‡å¯

## ğŸ“ æ—¥å¿—æŸ¥çœ‹

### æ§åˆ¶å°æ—¥å¿—
å¯åŠ¨æ—¶ç›´æ¥åœ¨æ§åˆ¶å°æŸ¥çœ‹

### æ–‡ä»¶æ—¥å¿—
é»˜è®¤ä½ç½®: `logs/xypai-app-bff.log`

### ä¿®æ”¹æ—¥å¿—çº§åˆ«ï¼ˆä¸´æ—¶ï¼‰
```bash
# å¯åŠ¨æ—¶æŒ‡å®šæ—¥å¿—çº§åˆ«
java -jar target/xypai-app-bff.jar --logging.level.org.dromara=DEBUG
```

## ğŸ¯ ä¸‹ä¸€æ­¥

å½“å‰æœåŠ¡è¿”å› Mock æ•°æ®ã€‚è¦å®ç°çœŸå®æ•°æ®èšåˆï¼š

1. **åˆ›å»º Dubbo RPC å®¢æˆ·ç«¯** - è°ƒç”¨ xypai-user å’Œ xypai-content
2. **å®ç° HomeFeedBizService** - ä¸šåŠ¡ç¼–æ’é€»è¾‘
3. **å®ç°æ¨èç®—æ³•** - RecommendationEngine
4. **é›†æˆ Redis ç¼“å­˜** - ç¼“å­˜æ¨èç»“æœ

è¯¦è§: [å®ç°è¿›åº¦.md](./å®ç°è¿›åº¦.md)

---

**æœ€åæ›´æ–°**: 2025-11-23
**ç»´æŠ¤è€…**: XyPai åç«¯å›¢é˜Ÿ
