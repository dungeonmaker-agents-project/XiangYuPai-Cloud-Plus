# Sa-Token è®¤è¯ä½“ç³»å¿«é€Ÿç†è§£

> æœ¬æ–‡æ¡£è¯´æ˜é¡¹ç›®ä¸­ Sa-Token çš„ä½¿ç”¨æ–¹å¼ã€æ ¸å¿ƒç»„ä»¶å’Œå…³é”®æŠ€æœ¯è¦ç‚¹ã€‚
> ç›®æ ‡ï¼š5 åˆ†é’Ÿç†è§£ Sa-Token å¦‚ä½•å®ç°å¾®æœåŠ¡è®¤è¯å’Œå†…éƒ¨æœåŠ¡éš”ç¦»ã€‚

---

## ğŸ“Œ æ ¸å¿ƒå®šä½

Sa-Token è®¤è¯æˆæƒæ¡†æ¶ï¼ŒåŸºäº Spring Cloud Gateway å®ç°ç»Ÿä¸€è®¤è¯ç½‘å…³ã€‚

**æ ¸å¿ƒèŒè´£**ï¼š
- ğŸ” Gateway ç»Ÿä¸€è®¤è¯æ‹¦æˆªï¼ˆBearer Tokenï¼‰
- ğŸ”’ å†…éƒ¨æœåŠ¡éš”ç¦»ï¼ˆSame-Token æœºåˆ¶ï¼‰
- ğŸ’¾ Token å­˜å‚¨åœ¨ Redisï¼Œæ”¯æŒ WebFlux å’Œ Servlet åŒç¯å¢ƒ

---

## ğŸ¯ ä¸»è¦åŠŸèƒ½

- **Gateway è®¤è¯**ï¼šæ‹¦æˆªæ‰€æœ‰è¯·æ±‚ â†’ éªŒè¯ Token â†’ æ£€æŸ¥ ClientId
- **Same-Token è½¬å‘**ï¼šGateway è‡ªåŠ¨æ·»åŠ å†…éƒ¨éªŒè¯ Token â†’ åç«¯æœåŠ¡æ ¡éªŒ
- **Token ç®¡ç†**ï¼šç™»å½•ç­¾å‘ Token â†’ Redis å­˜å‚¨ä¼šè¯ â†’ æ”¯æŒç™»å‡º/åˆ·æ–°
- **ç™½åå•æœºåˆ¶**ï¼šæ”¯æŒé…ç½®æ— éœ€è®¤è¯çš„æ¥å£
- **åŒç¯å¢ƒå…¼å®¹**ï¼šWebFluxï¼ˆGatewayï¼‰+ Servletï¼ˆåç«¯æœåŠ¡ï¼‰ç»Ÿä¸€ Token ç®¡ç†

---

## ğŸ—ï¸ æŠ€æœ¯æ ˆ

```
Spring Boot 3.x + Sa-Token 1.38.0 + Spring Cloud Gateway + Dubbo
Redis (Token ä¼šè¯å­˜å‚¨ + Same-Token åŒæ­¥)
```

**å…³é”®ä¾èµ–**ï¼š
- `sa-token-reactor-spring-boot3-starter`ï¼ˆGateway WebFlux ç¯å¢ƒï¼‰
- `sa-token-spring-boot3-starter`ï¼ˆåç«¯ Servlet ç¯å¢ƒï¼‰
- `sa-token-redis-jackson`ï¼ˆRedis é›†æˆï¼‰

---

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ ruoyi-gateway/                    # ç½‘å…³æ¨¡å—
â”‚   â””â”€â”€ src/main/java/.../gateway/
â”‚       â”œâ”€â”€ config/
â”‚       â”‚   â””â”€â”€ SameTokenInitializer.java    # âœ… Gateway å¯åŠ¨æ—¶åˆå§‹åŒ– Same-Token
â”‚       â””â”€â”€ filter/
â”‚           â”œâ”€â”€ AuthFilter.java              # âœ… ç”¨æˆ·è®¤è¯è¿‡æ»¤å™¨ï¼ˆéªŒè¯ Bearer Tokenï¼‰
â”‚           â””â”€â”€ ForwardAuthFilter.java       # âœ… è½¬å‘è®¤è¯è¿‡æ»¤å™¨ï¼ˆæ·»åŠ  Same-Tokenï¼‰
â”‚
â”œâ”€â”€ ruoyi-common/ruoyi-common-security/      # é€šç”¨å®‰å…¨æ¨¡å—
â”‚   â””â”€â”€ src/main/java/.../security/
â”‚       â””â”€â”€ config/
â”‚           â””â”€â”€ SecurityConfiguration.java   # âœ… åç«¯æœåŠ¡ Same-Token éªŒè¯é…ç½®
â”‚
â””â”€â”€ xypai-auth/                              # è®¤è¯æœåŠ¡
    â””â”€â”€ src/main/java/.../xypai/auth/
        â””â”€â”€ service/impl/
            â”œâ”€â”€ AppSmsAuthStrategy.java      # SMS ç™»å½•ç­–ç•¥ï¼ˆè°ƒç”¨ StpUtil.login()ï¼‰
            â””â”€â”€ AppPasswordAuthStrategy.java # å¯†ç ç™»å½•ç­–ç•¥ï¼ˆè°ƒç”¨ StpUtil.login()ï¼‰
```

**ç‰¹æ®Šè¯´æ˜**ï¼š
- âœ… æ—  XML é…ç½®ï¼Œå…¨æ³¨è§£é©±åŠ¨
- âœ… Same-Token å­˜å‚¨åœ¨ Redis ç»Ÿä¸€ keyï¼š`satoken:var:same-token`
- âš ï¸ WebFlux å’Œ Servlet ç¯å¢ƒä½¿ç”¨ä¸åŒçš„ Sa-Token starter ä¾èµ–

---

## ğŸ”‘ æ ¸å¿ƒæµç¨‹

### 1. ç”¨æˆ·ç™»å½•æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ App    â”‚  POST /xypai-auth/auth/login/sms
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1ï¸âƒ£ å‘é€æ‰‹æœºå· + éªŒè¯ç 
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway (AuthFilter æ”¾è¡Œ)   â”‚  ç™½åå•ï¼š/xypai-auth/auth/**
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2ï¸âƒ£ è½¬å‘åˆ°è®¤è¯æœåŠ¡
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  xypai-auth æœåŠ¡             â”‚
â”‚  AppSmsAuthStrategy          â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3ï¸âƒ£ éªŒè¯ç æ ¡éªŒ â†’ Dubbo è°ƒç”¨ xypai-user
       â”‚ 4ï¸âƒ£ StpUtil.login(userId)  # ç”Ÿæˆ Token
       â”‚ 5ï¸âƒ£ StpUtil.getTokenSession().set(USER_KEY, loginUser)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Redis                       â”‚
â”‚  satoken:login:token:xxx     â”‚  â† Token ä¼šè¯æ•°æ®
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. è®¿é—®å—ä¿æŠ¤æ¥å£æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯ App    â”‚  GET /xypai-user/api/user/profile/header
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  Header: Authorization: Bearer {token}
       â”‚
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway - AuthFilter (Order: default)          â”‚
â”‚  ğŸ“‹ æ­¥éª¤1: StpUtil.getTokenValue()              â”‚
â”‚  ğŸ“‹ æ­¥éª¤2: StpUtil.checkLogin()                 â”‚
â”‚  ğŸ“‹ æ­¥éª¤3: éªŒè¯ ClientId æ˜¯å¦åŒ¹é…               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ âœ… è®¤è¯é€šè¿‡
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gateway - ForwardAuthFilter (Order: -100)      â”‚
â”‚  ğŸ” ä» Redis è¯»å– Same-Token                    â”‚
â”‚  ğŸ”§ æ·»åŠ è¯·æ±‚å¤´: Same-Token: xxx                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚ ğŸš€ è½¬å‘åˆ°åç«¯æœåŠ¡ï¼ˆStripPrefix=1ï¼‰
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  xypai-user - SecurityConfiguration            â”‚
â”‚  ğŸ” æ‹¦æˆªå™¨: SaReactorFilter                     â”‚
â”‚  ğŸ“‹ æ­¥éª¤1: ä» Redis è¯»å–æœŸæœ›çš„ Same-Token       â”‚
â”‚  ğŸ“‹ æ­¥éª¤2: å¯¹æ¯”è¯·æ±‚å¤´ä¸­çš„ Same-Token            â”‚
â”‚  âœ… éªŒè¯é€šè¿‡ â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ›ï¸ å¾®æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Spring Cloud Gateway           â”‚  â† WebFlux ç¯å¢ƒ
â”‚  - AuthFilter (è®¤è¯)            â”‚     sa-token-reactor-spring-boot3-starter
â”‚  - ForwardAuthFilter (è½¬å‘)     â”‚
â”‚  - SameTokenInitializer (åˆå§‹åŒ–)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP          â”‚ Redis è¯»å†™
         â”‚               â”‚ satoken:var:same-token
         â†“               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯å¾®æœåŠ¡     â”‚  â”‚  Redis       â”‚
â”‚  - xypai-auth   â”‚  â”‚  - Token ä¼šè¯â”‚  â† å…±äº«å­˜å‚¨
â”‚  - xypai-user   â”‚  â”‚  - Same-Tokenâ”‚
â”‚  - system       â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚  ...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Servlet ç¯å¢ƒ
         â”‚ sa-token-spring-boot3-starter
         â”‚
         â”‚ SecurityConfiguration
         â”‚ â”œâ”€ éªŒè¯ Same-Tokenï¼ˆé˜²æ­¢ç»•è¿‡ Gatewayï¼‰
         â”‚ â””â”€ è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯ï¼ˆLoginHelperï¼‰
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL æ•°æ®åº“   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è°ƒç”¨é“¾è·¯è¯´æ˜**ï¼š
1. Gateway ä½¿ç”¨ WebFluxï¼ˆReactiveï¼‰ï¼Œåç«¯æœåŠ¡ä½¿ç”¨ Servletï¼ˆBlockingï¼‰
2. Same-Token é€šè¿‡ Redis ç»Ÿä¸€å­˜å‚¨ï¼Œé¿å…ç¯å¢ƒå·®å¼‚å¯¼è‡´ä¸ä¸€è‡´
3. Gateway ä¸è¿æ¥æ•°æ®åº“ï¼Œä»…éªŒè¯ Token + è½¬å‘è¯·æ±‚

---

## ğŸ”¥ æŠ€æœ¯äº®ç‚¹

### 1. **Same-Token åŒæ­¥æœºåˆ¶**
   - **é—®é¢˜**ï¼šWebFlux å’Œ Servlet ç¯å¢ƒä¸‹ `SaSameUtil.getToken()` è¿”å›ä¸åŒå€¼
   - **è§£å†³**ï¼šGateway å¯åŠ¨æ—¶ç”Ÿæˆ Same-Token â†’ å­˜å‚¨åˆ° Redis ç»Ÿä¸€ key
   - **éªŒè¯**ï¼šGateway å’Œåç«¯æœåŠ¡éƒ½ä» Redis è¯»å–åŒä¸€ä¸ª Same-Token

### 2. **å†…éƒ¨æœåŠ¡éš”ç¦»**
   - **ç›®çš„**ï¼šé˜²æ­¢è·³è¿‡ Gateway ç›´æ¥è®¿é—®åç«¯æœåŠ¡
   - **æœºåˆ¶**ï¼šGateway æ·»åŠ  Same-Token è¯·æ±‚å¤´ â†’ åç«¯æœåŠ¡å¼ºåˆ¶éªŒè¯
   - **ä¼˜åŠ¿**ï¼šå³ä½¿è·å–åˆ°ç”¨æˆ· Tokenï¼Œä¹Ÿæ— æ³•ç»•è¿‡ Gatewayï¼ˆå› ç¼ºå°‘ Same-Tokenï¼‰

### 3. **åŒè¿‡æ»¤å™¨è®¾è®¡**
   - **AuthFilter**ï¼ˆé»˜è®¤é¡ºåºï¼‰ï¼šéªŒè¯ç”¨æˆ·èº«ä»½ï¼ˆTokenã€ClientIdï¼‰
   - **ForwardAuthFilter**ï¼ˆOrder=-100ï¼Œä¼˜å…ˆæ‰§è¡Œï¼‰ï¼šæ·»åŠ  Same-Token
   - **æ‰§è¡Œé¡ºåº**ï¼šForwardAuthFilter â†’ AuthFilter â†’ è·¯ç”±è½¬å‘

### 4. **Redis é›†æˆä¼˜åŒ–**
   - **ä¼šè¯æ•°æ®**ï¼š`satoken:login:token:{token}` å­˜å‚¨ç”¨æˆ·ç™»å½•ä¿¡æ¯
   - **Same-Token**ï¼š`satoken:var:same-token` å­˜å‚¨å†…éƒ¨éªŒè¯ Tokenï¼ˆ7 å¤©æœ‰æ•ˆæœŸï¼‰
   - **ä¼˜åŠ¿**ï¼šæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½² + Token æŒä¹…åŒ–

### 5. **ç™½åå•é…ç½®**
   - **é…ç½®ç±»**ï¼š`IgnoreWhiteProperties`ï¼ˆä» Nacos åŠ¨æ€åŠ è½½ï¼‰
   - **å…¸å‹è·¯å¾„**ï¼š`/xypai-auth/auth/**`ã€`/actuator/**`
   - **çµæ´»æ€§**ï¼šæ”¯æŒ Ant é£æ ¼é€šé…ç¬¦ï¼ˆå¦‚ `/api/*/public/**`ï¼‰

---

## ğŸš€ å¿«é€Ÿå¯åŠ¨æ£€æŸ¥æ¸…å•

### 1. Redis é…ç½®éªŒè¯
```bash
# æ£€æŸ¥ Redis è¿æ¥
redis-cli -h localhost -p 6379 -a ruoyi123

# æŸ¥çœ‹ Same-Token æ˜¯å¦åˆå§‹åŒ–
GET satoken:var:same-token

# æŸ¥çœ‹ç™»å½• Tokenï¼ˆç™»å½•åï¼‰
KEYS satoken:login:token:*
```

### 2. Gateway å¯åŠ¨æ—¥å¿—æ£€æŸ¥
```
âœ… [SAME-TOKEN-INIT] Same-Token åˆå§‹åŒ–æˆåŠŸ
   Redis Key: satoken:var:same-token
   Token: kMn8x7... (å‰40ä½)
   è¿‡æœŸæ—¶é—´: 7å¤©
```

### 3. è®¤è¯æµç¨‹æ—¥å¿—æ£€æŸ¥
```
ğŸ” [AUTH-FILTER] ========== å¼€å§‹è®¤è¯æµç¨‹ ==========
  ğŸ“‹ æ­¥éª¤1: è·å– Token
  ğŸ“‹ æ­¥éª¤2: æ£€æŸ¥ç™»å½•çŠ¶æ€
     âœ… Token éªŒè¯é€šè¿‡ï¼ç”¨æˆ·å·²ç™»å½•
  ğŸ“‹ æ­¥éª¤3: éªŒè¯ ClientId
     âœ… ClientId éªŒè¯é€šè¿‡
  âœ… [AUTH-FILTER] ========== è®¤è¯æˆåŠŸ ==========

ğŸ”‘ [FORWARD-AUTH-FILTER] ========== æ·»åŠ  Same-Token ==========
  ä» Redis è¯»å–çš„ Same-Token: kMn8x7...
  âœ… Same-Token å·²æ·»åŠ åˆ°è¯·æ±‚å¤´
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### âš ï¸ å…³é”®é…ç½®

1. **ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒä¾èµ–**
   - Gatewayï¼ˆWebFluxï¼‰ï¼š`sa-token-reactor-spring-boot3-starter`
   - åç«¯æœåŠ¡ï¼ˆServletï¼‰ï¼š`sa-token-spring-boot3-starter`
   - âŒ ä¸èƒ½æ··ç”¨ï¼Œå¦åˆ™ä¼šå¯¼è‡´ Token éªŒè¯å¤±è´¥

2. **Same-Token å¿…é¡»å¯ç”¨**
   ```yaml
   sa-token:
     check-same-token: true  # âš ï¸ Gateway å’Œåç«¯æœåŠ¡éƒ½è¦é…ç½®
   ```

3. **Redis é…ç½®å¿…é¡»ä¸€è‡´**
   - æ‰€æœ‰æœåŠ¡å¿…é¡»è¿æ¥åŒä¸€ä¸ª Redis å®ä¾‹
   - ç¡®ä¿ Redis å¯è®¿é—®ï¼ˆå¯†ç ã€ç«¯å£ã€ç½‘ç»œï¼‰

4. **ForwardAuthFilter æ‰§è¡Œé¡ºåº**
   - `getOrder()` è¿”å› `-100`ï¼Œç¡®ä¿åœ¨ AuthFilter ä¹‹å‰æ‰§è¡Œ
   - âŒ ä¸è¦ä¿®æ”¹é¡ºåºï¼Œå¦åˆ™ Same-Token å¯èƒ½ä¸¢å¤±

5. **ç™½åå•è·¯å¾„é…ç½®**
   - è®¤è¯æ¥å£å¿…é¡»åœ¨ç™½åå•ï¼š`/xypai-auth/auth/**`
   - Actuator å¥åº·æ£€æŸ¥éœ€è¦å•ç‹¬é…ç½®ï¼ˆBasic Authï¼‰
   - æµ‹è¯•æ—¶å¯ä¸´æ—¶æ·»åŠ è·¯å¾„åˆ°ç™½åå•

### ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

**é—®é¢˜ 1ï¼šè®¤è¯å¤±è´¥ï¼Œæ— æ³•è®¿é—®ç³»ç»Ÿèµ„æº**
- âœ… æ£€æŸ¥ Redis ä¸­æ˜¯å¦æœ‰ `satoken:var:same-token`
- âœ… æ£€æŸ¥ Gateway å¯åŠ¨æ—¥å¿—æ˜¯å¦æœ‰åˆå§‹åŒ–æˆåŠŸæç¤º
- âœ… å¯¹æ¯” Gateway å’Œåç«¯æœåŠ¡çš„ Same-Token æ˜¯å¦ä¸€è‡´

**é—®é¢˜ 2ï¼šToken éªŒè¯å¤±è´¥**
- âœ… æ£€æŸ¥è¯·æ±‚å¤´æ˜¯å¦åŒ…å« `Authorization: Bearer {token}`
- âœ… æ£€æŸ¥ Token æ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤ 30 å¤©ï¼‰
- âœ… æ£€æŸ¥ ClientId æ˜¯å¦åŒ¹é…

**é—®é¢˜ 3ï¼šç»•è¿‡ Gateway ç›´æ¥è®¿é—®åç«¯æœåŠ¡**
- âœ… åç«¯æœåŠ¡åº”è¯¥æ‹’ç»ï¼ˆå› ä¸ºæ²¡æœ‰ Same-Tokenï¼‰
- âœ… æ£€æŸ¥ `SecurityConfiguration` æ˜¯å¦æ­£ç¡®é…ç½®
- âœ… æ£€æŸ¥ `check-same-token` æ˜¯å¦å¯ç”¨

---

## ğŸ“– ç›¸å…³æ–‡ä»¶å¿«é€Ÿç´¢å¼•

| æ–‡ä»¶ | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| **Gateway è®¤è¯è¿‡æ»¤å™¨** | `ruoyi-gateway/.../AuthFilter.java` | éªŒè¯ Bearer Token + ClientId |
| **Gateway è½¬å‘è¿‡æ»¤å™¨** | `ruoyi-gateway/.../ForwardAuthFilter.java` | æ·»åŠ  Same-Token è¯·æ±‚å¤´ |
| **Gateway Same-Token åˆå§‹åŒ–** | `ruoyi-gateway/.../SameTokenInitializer.java` | å¯åŠ¨æ—¶ç”Ÿæˆå¹¶å­˜å‚¨åˆ° Redis |
| **åç«¯æœåŠ¡å®‰å…¨é…ç½®** | `ruoyi-common-security/.../SecurityConfiguration.java` | éªŒè¯ Same-Token |
| **ç™½åå•é…ç½®** | `ruoyi-gateway/.../IgnoreWhiteProperties.java` | æ— éœ€è®¤è¯çš„æ¥å£åˆ—è¡¨ |
| **SMS ç™»å½•ç­–ç•¥** | `xypai-auth/.../AppSmsAuthStrategy.java` | è°ƒç”¨ `StpUtil.login()` ç”Ÿæˆ Token |
| **å¯†ç ç™»å½•ç­–ç•¥** | `xypai-auth/.../AppPasswordAuthStrategy.java` | è°ƒç”¨ `StpUtil.login()` ç”Ÿæˆ Token |

---

## âœ… ç¼–å†™ä¿¡æ¯

- **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0
- **æœ€åæ›´æ–°**ï¼š2025-11-19
- **é€‚ç”¨ç‰ˆæœ¬**ï¼šSa-Token 1.38.0 + Spring Boot 3.x
- **ä½œè€…**ï¼šXiangYuPai Team
