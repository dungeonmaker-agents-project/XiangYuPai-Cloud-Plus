# ğŸ¨ Tokenåˆ›å»ºæµç¨‹å¯è§†åŒ–

> **é€šè¿‡å¯è§†åŒ–æµç¨‹å›¾å¿«é€Ÿç†è§£Tokençš„åˆ›å»ºã€å­˜å‚¨å’Œä½¿ç”¨æœºåˆ¶**

---

## ğŸ”„ å®Œæ•´æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Tokenåˆ›å»ºä¸å­˜å‚¨å®Œæ•´æµç¨‹                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯     â”‚â”€â”€â”€â”€â–¶â”‚   Gateway   â”‚â”€â”€â”€â”€â–¶â”‚ Auth Service â”‚â”€â”€â”€â”€â–¶â”‚   Redis     â”‚
â”‚  (å‰ç«¯/APP)  â”‚     â”‚  (ç½‘å…³å±‚)    â”‚     â”‚  (è®¤è¯æœåŠ¡)   â”‚     â”‚  (å­˜å‚¨å±‚)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ ç™»å½•è¯·æ±‚
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å®¢æˆ·ç«¯å‘é€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /login                           â”‚
â”‚ {                                     â”‚
â”‚   "username": "admin",                â”‚
â”‚   "password": "admin123",             â”‚
â”‚   "clientId": "e5cd7e48...",         â”‚
â”‚   "grantType": "password"            â”‚
â”‚ }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        [Gatewayè½¬å‘]
              â†“
TokenController.login() æ¥æ”¶è¯·æ±‚


2ï¸âƒ£ è®¤è¯ç­–ç•¥é€‰æ‹©
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

IAuthStrategy.login(body, client, grantType)
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            â”‚             â”‚              â”‚
â–¼                            â–¼             â–¼              â–¼
PasswordAuthStrategy   SmsAuthStrategy  SocialAuth   EmailAuth
(å¯†ç ç™»å½•)              (çŸ­ä¿¡ç™»å½•)       (ç¬¬ä¸‰æ–¹)      (é‚®ç®±ç™»å½•)


3ï¸âƒ£ å¯†ç è®¤è¯æµç¨‹ï¼ˆä»¥PasswordAuthStrategyä¸ºä¾‹ï¼‰
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

PasswordAuthStrategy.login()
   â”‚
   â”œâ”€â–¶ â‘  è§£æè¯·æ±‚å‚æ•°ï¼ˆusername, password, code, uuidï¼‰
   â”‚
   â”œâ”€â–¶ â‘¡ éªŒè¯ç æ ¡éªŒï¼ˆå¦‚æœå¼€å¯ï¼‰
   â”‚      â””â”€ Redis: GET captcha_code_key:{uuid}
   â”‚
   â”œâ”€â–¶ â‘¢ æ•°æ®åº“æŸ¥è¯¢ç”¨æˆ·
   â”‚      â””â”€ remoteUserService.getUserInfo(username, tenantId)
   â”‚         â””â”€ SELECT * FROM sys_user WHERE username=? AND tenant_id=?
   â”‚
   â”œâ”€â–¶ â‘£ BCryptå¯†ç éªŒè¯
   â”‚      â””â”€ BCrypt.checkpw(inputPassword, dbPassword)
   â”‚
   â”œâ”€â–¶ â‘¤ æ„å»ºLoginUserå¯¹è±¡
   â”‚      â””â”€ LoginUser { userId, username, roles, permissions, ... }
   â”‚
   â”œâ”€â–¶ â‘¥ æ„å»ºSa-Tokenç™»å½•å‚æ•°
   â”‚      â””â”€ SaLoginParameter {
   â”‚            deviceType: "pc",
   â”‚            timeout: 1800,
   â”‚            activeTimeout: -1,
   â”‚            extra: { clientid: "..." }
   â”‚         }
   â”‚
   â””â”€â–¶ â‘¦ ç”ŸæˆToken
          â””â”€ LoginHelper.login(loginUser, model)  [æ ¸å¿ƒæ­¥éª¤]


4ï¸âƒ£ LoginHelper.login() - Tokenç”Ÿæˆæ ¸å¿ƒ
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

LoginHelper.login(loginUser, model)
   â”‚
   â”œâ”€â–¶ Step 1: StpUtil.login(loginId, model)
   â”‚            â”‚
   â”‚            â”œâ”€ ç”ŸæˆTokenå€¼ï¼ˆJWTæ ¼å¼ï¼‰
   â”‚            â”‚  token = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
   â”‚            â”‚
   â”‚            â””â”€ è®¾ç½®Token Extraä¿¡æ¯ï¼ˆå…ƒæ•°æ®ï¼‰
   â”‚               model.setExtra("tenantId", "000000")
   â”‚               model.setExtra("userId", "1")
   â”‚               model.setExtra("userName", "admin")
   â”‚               model.setExtra("deptId", "103")
   â”‚               model.setExtra("clientid", "e5cd7e48...")
   â”‚
   â””â”€â–¶ Step 2: StpUtil.getTokenSession().set("loginUser", loginUser)
               â””â”€ å­˜å‚¨å®Œæ•´LoginUserå¯¹è±¡åˆ°Redis


5ï¸âƒ£ Rediså­˜å‚¨ç»“æ„
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Rediså­˜å‚¨5ä¸ªå…³é”®æ•°æ®:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key 1: satoken:login:token:{tokenValue}                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Value: "1"  (loginId)                                                   â”‚
â”‚ TTL: 1800ç§’                                                              â”‚
â”‚ ä½œç”¨: Tokenå€¼åˆ°ç”¨æˆ·IDçš„æ˜ å°„                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key 2: satoken:login:session:{tokenValue}                              â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Value: {                                                                â”‚
â”‚   "loginUser": {                                                        â”‚
â”‚     "userId": 1,                                                        â”‚
â”‚     "username": "admin",                                                â”‚
â”‚     "tenantId": "000000",                                               â”‚
â”‚     "roles": ["admin"],                                                 â”‚
â”‚     "permissions": ["*:*:*"],                                           â”‚
â”‚     "deptId": 103,                                                      â”‚
â”‚     ...                                                                 â”‚
â”‚   }                                                                     â”‚
â”‚ }                                                                       â”‚
â”‚ TTL: 1800ç§’                                                              â”‚
â”‚ ä½œç”¨: å®Œæ•´çš„ç”¨æˆ·ä¼šè¯ä¿¡æ¯                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key 3: satoken:login:id:{loginId}                                      â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Value: ["token1", "token2", ...]                                        â”‚
â”‚ TTL: æ°¸ä¹…                                                                â”‚
â”‚ ä½œç”¨: ç”¨æˆ·æ‰€æœ‰è®¾å¤‡çš„Tokenåˆ—è¡¨ï¼ˆæ”¯æŒå¤šè®¾å¤‡ç™»å½•ï¼‰                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key 4: satoken:login:extra:{tokenValue}:userId                         â”‚
â”‚        satoken:login:extra:{tokenValue}:tenantId                       â”‚
â”‚        satoken:login:extra:{tokenValue}:userName                       â”‚
â”‚        satoken:login:extra:{tokenValue}:clientid                       â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Value: "1" / "000000" / "admin" / "e5cd7e48..."                        â”‚
â”‚ TTL: 1800ç§’                                                              â”‚
â”‚ ä½œç”¨: Tokenå…ƒæ•°æ®ï¼Œå¿«é€Ÿè®¿é—®ï¼ˆä¸éœ€è¦ååºåˆ—åŒ–å®Œæ•´å¯¹è±¡ï¼‰                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Key 5: satoken:login:last-active:{tokenValue}                          â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€     â”‚
â”‚ Value: 1699999999999  (æ—¶é—´æˆ³)                                          â”‚
â”‚ TTL: 1800ç§’                                                              â”‚
â”‚ ä½œç”¨: æœ€åæ´»è·ƒæ—¶é—´ï¼ˆç”¨äºæ´»è·ƒè¶…æ—¶æ£€æµ‹ï¼‰                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


6ï¸âƒ£ è¿”å›Tokenç»™å®¢æˆ·ç«¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Auth Service è¿”å›:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ {                                     â”‚
â”‚   "code": 200,                        â”‚
â”‚   "msg": "æ“ä½œæˆåŠŸ",                   â”‚
â”‚   "data": {                           â”‚
â”‚     "accessToken": "eyJhbGc...",     â”‚
â”‚     "expireIn": 1800,                â”‚
â”‚     "clientId": "e5cd7e48..."        â”‚
â”‚   }                                   â”‚
â”‚ }                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
        [Gatewayè½¬å‘]
              â†“
          å®¢æˆ·ç«¯æ¥æ”¶


7ï¸âƒ£ å®¢æˆ·ç«¯åç»­è¯·æ±‚ä½¿ç”¨Token
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

å®¢æˆ·ç«¯å‘é€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /api/v1/user/profile                       â”‚
â”‚                                                â”‚
â”‚ Headers:                                       â”‚
â”‚   Authorization: Bearer eyJhbGciOiJIUzI1N...  â”‚
â”‚   clientid: e5cd7e48...                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gateway: AuthFilter æ‹¦æˆª              â”‚
â”‚                                      â”‚
â”‚ 1. æå–Token                          â”‚
â”‚ 2. è°ƒç”¨StpUtil.checkLogin()          â”‚
â”‚    â””â”€ RediséªŒè¯Tokenæ˜¯å¦æœ‰æ•ˆ           â”‚
â”‚ 3. éªŒè¯é€šè¿‡ï¼Œè½¬å‘åˆ°åç«¯æœåŠ¡             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸šåŠ¡æœåŠ¡: UserController              â”‚
â”‚                                      â”‚
â”‚ @GetMapping("/profile")              â”‚
â”‚ public R<User> getProfile() {        â”‚
â”‚   // è·å–å½“å‰ç”¨æˆ·ID                   â”‚
â”‚   Long userId = LoginHelper         â”‚
â”‚      .getUserId();                  â”‚
â”‚   // â†‘ è‡ªåŠ¨ä»Redisè¯»å–               â”‚
â”‚                                      â”‚
â”‚   return userService.getById        â”‚
â”‚      (userId);                      â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ å¤šçº§ç¼“å­˜æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Tokenè¯»å–æµç¨‹ï¼ˆå¤šçº§ç¼“å­˜ï¼‰                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¯·æ±‚: LoginHelper.getUserId()
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: æŸ¥è¯¢ä¸€çº§ç¼“å­˜ï¼ˆCaffeine - JVMæœ¬åœ°å†…å­˜ï¼‰   â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Key: satoken:login:extra:{token}:userId         â”‚
â”‚ ç¼“å­˜æ—¶é—´: 5ç§’                                    â”‚
â”‚ æœ€å¤§å®¹é‡: 1000æ¡                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â”œâ”€ å‘½ä¸­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                   â”‚
          â””â”€ æœªå‘½ä¸­                             â”‚
              â†“                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: æŸ¥è¯¢äºŒçº§ç¼“å­˜ï¼ˆRedis - åˆ†å¸ƒå¼ç¼“å­˜ï¼‰        â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ Key: satoken:login:extra:{token}:userId         â”‚
â”‚ ç¼“å­˜æ—¶é—´: 1800ç§’                                 â”‚
â”‚ ç½‘ç»œå»¶è¿Ÿ: ~2-5ms                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                   â”‚
          â””â”€ å†™å›Caffeineç¼“å­˜                   â”‚
          â†“                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: è¿”å›ç»“æœ                                â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ userId: 1                                       â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ å“åº”æ—¶é—´: 0.1ms (Caffeine) / 5ms (Redis)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€§èƒ½å¯¹æ¯”:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 ç¼“å­˜å±‚çº§    â”‚  å“åº”æ—¶é—´  â”‚  QPS    â”‚  ç½‘ç»œIO  â”‚  ä½¿ç”¨åœºæ™¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 æ— ç¼“å­˜      â”‚  ~5ms     â”‚  2,000  â”‚  æ˜¯      â”‚  ä¸æ¨è
 Redisç¼“å­˜   â”‚  ~5ms     â”‚  5,000  â”‚  æ˜¯      â”‚  åˆ†å¸ƒå¼å…±äº«
 Caffeine    â”‚  ~0.1ms   â”‚  50,000 â”‚  å¦      â”‚  é«˜å¹¶å‘è¯»å–
 åŒå±‚ç¼“å­˜    â”‚  ~0.5ms   â”‚  20,000 â”‚  éƒ¨åˆ†     â”‚  ç”Ÿäº§æ¨è âœ…
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

---

## ğŸ”‘ Tokenæ•°æ®ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Tokenæ•°æ®å±‚çº§ç»“æ„                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tokenå­—ç¬¦ä¸²ï¼ˆJWTæ ¼å¼ï¼‰
â”œâ”€ eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
â”‚  (å®¢æˆ·ç«¯å‘é€: Authorization: Bearer {token})
â”‚
â””â”€ Rediså­˜å‚¨ç»“æ„:
   â”‚
   â”œâ”€ ğŸ“¦ Token Basic Info (åŸºç¡€æ˜ å°„)
   â”‚  â””â”€ satoken:login:token:{tokenValue} = "1"
   â”‚     â””â”€ å¿«é€Ÿè·å–LoginId
   â”‚
   â”œâ”€ ğŸ“¦ Token Extra (è½»é‡çº§å…ƒæ•°æ®)
   â”‚  â”œâ”€ satoken:login:extra:{tokenValue}:userId = "1"
   â”‚  â”œâ”€ satoken:login:extra:{tokenValue}:tenantId = "000000"
   â”‚  â”œâ”€ satoken:login:extra:{tokenValue}:userName = "admin"
   â”‚  â”œâ”€ satoken:login:extra:{tokenValue}:deptId = "103"
   â”‚  â””â”€ satoken:login:extra:{tokenValue}:clientid = "e5cd7e48..."
   â”‚     â””â”€ å¿«é€Ÿè®¿é—®ï¼ˆä¸éœ€è¦ååºåˆ—åŒ–ï¼‰
   â”‚
   â”œâ”€ ğŸ“¦ Token Session (å®Œæ•´ç”¨æˆ·å¯¹è±¡)
   â”‚  â””â”€ satoken:login:session:{tokenValue} = {
   â”‚        "loginUser": {
   â”‚          "userId": 1,
   â”‚          "username": "admin",
   â”‚          "tenantId": "000000",
   â”‚          "deptId": 103,
   â”‚          "deptName": "ç ”å‘éƒ¨é—¨",
   â”‚          "roles": ["admin"],
   â”‚          "roleIds": [1],
   â”‚          "permissions": ["*:*:*"],
   â”‚          "menuIds": [1, 2, 3, ...],
   â”‚          "clientKey": "e5cd7e48...",
   â”‚          "deviceType": "pc"
   â”‚        }
   â”‚     }
   â”‚     â””â”€ å®Œæ•´ä¿¡æ¯ï¼ˆéœ€è¦ååºåˆ—åŒ–ï¼‰
   â”‚
   â”œâ”€ ğŸ“¦ User Token List (ç”¨æˆ·Tokenåˆ—è¡¨)
   â”‚  â””â”€ satoken:login:id:1 = ["token1", "token2", ...]
   â”‚     â””â”€ æ”¯æŒå¤šè®¾å¤‡ç™»å½•ç®¡ç†
   â”‚
   â””â”€ ğŸ“¦ Last Active Time (æœ€åæ´»è·ƒæ—¶é—´)
      â””â”€ satoken:login:last-active:{tokenValue} = 1699999999999
         â””â”€ ç”¨äºæ´»è·ƒè¶…æ—¶æ£€æµ‹
```

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹å¯¹æ¯”

### **åœºæ™¯1: åªéœ€è¦ç”¨æˆ·ID**

```java
// âœ… æ¨èï¼šä½¿ç”¨Extraï¼ˆé€Ÿåº¦å¿«ï¼‰
Long userId = LoginHelper.getUserId();
// RedisæŸ¥è¯¢: GET satoken:login:extra:{token}:userId
// å“åº”æ—¶é—´: ~0.5ms (Caffeineç¼“å­˜å‘½ä¸­)

// âŒ ä¸æ¨èï¼šä½¿ç”¨Sessionï¼ˆæ…¢10å€ï¼‰
LoginUser user = LoginHelper.getLoginUser();
Long userId = user.getUserId();
// RedisæŸ¥è¯¢: GET satoken:login:session:{token}
// éœ€è¦ååºåˆ—åŒ–å®Œæ•´LoginUserå¯¹è±¡
// å“åº”æ—¶é—´: ~5ms
```

### **åœºæ™¯2: éœ€è¦ç”¨æˆ·å®Œæ•´ä¿¡æ¯**

```java
// âœ… æ­£ç¡®ï¼šå¿…é¡»è·å–å®Œæ•´å¯¹è±¡æ—¶ä½¿ç”¨
LoginUser loginUser = LoginHelper.getLoginUser();
Set<String> roles = loginUser.getRoles();
Set<String> permissions = loginUser.getMenuPermission();
// ä¸€æ¬¡æŸ¥è¯¢è·å–æ‰€æœ‰ä¿¡æ¯
```

### **åœºæ™¯3: æƒé™æ£€æŸ¥**

```java
// âœ… æ¨èï¼šä½¿ç”¨æ³¨è§£ï¼ˆå£°æ˜å¼ï¼‰
@SaCheckPermission("system:user:add")
@PostMapping("/add")
public R<Void> add(@RequestBody User user) {
    return userService.save(user);
}

// âš ï¸ å¤‡é€‰ï¼šç¼–ç¨‹å¼æƒé™æ£€æŸ¥
@PostMapping("/add")
public R<Void> add(@RequestBody User user) {
    StpUtil.checkPermission("system:user:add");
    return userService.save(user);
}
```

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Tokenå®‰å…¨é˜²æŠ¤æœºåˆ¶                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ CSRFé˜²æŠ¤
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
é…ç½®: sa-token.is-read-cookie = false
åŸç†: ç¦æ­¢ä»Cookieè¯»å–Tokenï¼Œåªå…è®¸Headerä¼ é€’
ç»“æœ: æ”»å‡»è€…æ— æ³•é€šè¿‡CSRFåˆ©ç”¨æµè§ˆå™¨è‡ªåŠ¨æºå¸¦Cookieçš„ç‰¹æ€§

2ï¸âƒ£ Tokenè¿‡æœŸæœºåˆ¶
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
è¶…æ—¶ç±»å‹:
  â”œâ”€ timeout: å›ºå®šè¶…æ—¶ï¼ˆ1800ç§’ = 30åˆ†é’Ÿï¼‰
  â”‚   â””â”€ Tokenåˆ›å»ºå30åˆ†é’Ÿè‡ªåŠ¨å¤±æ•ˆ
  â”‚
  â””â”€ activeTimeout: æ´»è·ƒè¶…æ—¶ï¼ˆå¯é€‰ï¼‰
      â””â”€ ç”¨æˆ·30åˆ†é’Ÿæ— æ“ä½œè‡ªåŠ¨å¤±æ•ˆ
      â””â”€ æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨åˆ·æ–°æ´»è·ƒæ—¶é—´

3ï¸âƒ£ å¤šè®¾å¤‡ç®¡ç†
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
åŠŸèƒ½:
  â”œâ”€ æŸ¥çœ‹æ‰€æœ‰åœ¨çº¿è®¾å¤‡
  â”‚   â””â”€ StpUtil.getTokenValueListByLoginId("1")
  â”‚
  â”œâ”€ è¸¢å‡ºæŒ‡å®šè®¾å¤‡
  â”‚   â””â”€ StpUtil.kickout("1", "app")
  â”‚
  â””â”€ å•ç‚¹ç™»å½•ï¼ˆå¯é€‰ï¼‰
      â””â”€ is-concurrent: false (åªå…è®¸ä¸€ä¸ªè®¾å¤‡ç™»å½•)

4ï¸âƒ£ Tokenç­¾åéªŒè¯
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ä½¿ç”¨: Sa-Token JWTæ¨¡å¼
ç®—æ³•: HMAC SHA256
å¯†é’¥: é…ç½®æ–‡ä»¶ä¸­çš„jwt-secret-key
é˜²æŠ¤: é˜²æ­¢Tokenç¯¡æ”¹
```

---

## ğŸ“Š æ€§èƒ½ç›‘æ§

```
Tokenæ“ä½œæ€§èƒ½åŸºå‡†ï¼ˆå•æ¬¡æ“ä½œï¼‰:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ“ä½œ                          â”‚ å“åº”æ—¶é—´      â”‚ QPS       â”‚ è¯´æ˜
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
LoginHelper.getUserId()       â”‚ ~0.5ms       â”‚ 20,000    â”‚ è¯»Extraï¼ˆæ¨èï¼‰
LoginHelper.getUsername()     â”‚ ~0.5ms       â”‚ 20,000    â”‚ è¯»Extra
LoginHelper.getTenantId()     â”‚ ~0.5ms       â”‚ 20,000    â”‚ è¯»Extra
LoginHelper.getLoginUser()    â”‚ ~5ms         â”‚ 2,000     â”‚ è¯»Sessionï¼ˆé‡ï¼‰
StpUtil.checkLogin()          â”‚ ~0.5ms       â”‚ 20,000    â”‚ TokenéªŒè¯
StpUtil.checkPermission()     â”‚ ~5ms         â”‚ 2,000     â”‚ éœ€è¦ååºåˆ—åŒ–
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ä¼˜åŒ–å»ºè®®:
âœ… ä¼˜å…ˆä½¿ç”¨ LoginHelper.getUserId() ç­‰è½»é‡çº§æ–¹æ³•
âœ… é¿å…é¢‘ç¹è°ƒç”¨ LoginHelper.getLoginUser()
âœ… ä½¿ç”¨ @SaCheckPermission æ³¨è§£ä»£æ›¿ç¼–ç¨‹å¼æƒé™æ£€æŸ¥
âœ… å¼€å¯Caffeineç¼“å­˜ï¼ˆé»˜è®¤å·²å¼€å¯ï¼‰
```

---

## ğŸ¯ å¸¸è§é—®é¢˜

### **Q1: Tokenå­˜å‚¨åœ¨å“ªé‡Œï¼Ÿ**
```
A: å¤šçº§å­˜å‚¨
  â”œâ”€ å®¢æˆ·ç«¯: LocalStorage / SessionStorage (å‰ç«¯)
  â”œâ”€ Caffeineç¼“å­˜: JVMå†…å­˜ï¼ˆ5ç§’TTLï¼‰
  â””â”€ Redis: æŒä¹…åŒ–å­˜å‚¨ï¼ˆ1800ç§’TTLï¼‰
```

### **Q2: Tokenå¦‚ä½•è·¨æœåŠ¡ä¼ é€’ï¼Ÿ**
```
A: è‡ªåŠ¨ä¼ é€’æœºåˆ¶
  1. å®¢æˆ·ç«¯ â†’ Gateway: Headeræºå¸¦ Authorization
  2. Gateway â†’ åç«¯æœåŠ¡: Gatewayè‡ªåŠ¨è½¬å‘Header
  3. åç«¯æœåŠ¡: LoginHelperè‡ªåŠ¨ä»å½“å‰è¯·æ±‚è¯»å–Token
```

### **Q3: å¦‚ä½•å®ç°Tokenç»­æœŸï¼Ÿ**
```
A: ä¸¤ç§æ–¹å¼
  â”œâ”€ æ–¹å¼1: è‡ªåŠ¨ç»­æœŸï¼ˆæ¨èï¼‰
  â”‚   â””â”€ é…ç½®: sa-token.dynamic-active-timeout = true
  â”‚   â””â”€ æ•ˆæœ: æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨åˆ·æ–°è¿‡æœŸæ—¶é—´
  â”‚
  â””â”€ æ–¹å¼2: åˆ·æ–°Tokenæ¥å£
      â””â”€ POST /auth/refresh
      â””â”€ è¿”å›æ–°Token
```

### **Q4: å¦‚ä½•å®ç°å¼ºåˆ¶ä¸‹çº¿ï¼Ÿ**
```java
// æ–¹å¼1: è¸¢å‡ºæŒ‡å®šè®¾å¤‡
StpUtil.kickout(userId, deviceType);

// æ–¹å¼2: è¸¢å‡ºæ‰€æœ‰è®¾å¤‡
StpUtil.logout(userId);

// æ–¹å¼3: è¸¢å‡ºæŒ‡å®šToken
StpUtil.logoutByTokenValue(tokenValue);
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [Sa-Tokenåˆ›å»ºä¸å­˜å‚¨æœºåˆ¶è¯¦è§£](./Sa-Tokenåˆ›å»ºä¸å­˜å‚¨æœºåˆ¶è¯¦è§£.md) - æŠ€æœ¯ç»†èŠ‚
- [Sa-Tokenå¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹æŒ‡å—](./Sa-Tokenå¼€å‘è€…å¿«é€Ÿä¸Šæ‰‹æŒ‡å—.md) - å¼€å‘æŒ‡å—
- [Sa-Tokenå®Œæ•´æŠ€æœ¯æ¶æ„æ–‡æ¡£](./Sa-Tokenå®Œæ•´æŠ€æœ¯æ¶æ„æ–‡æ¡£.md) - æ¶æ„è®¾è®¡

---

**æœ¬æ–‡æ¡£é€šè¿‡å¯è§†åŒ–æµç¨‹å›¾å¸®åŠ©å¼€å‘è€…å¿«é€Ÿç†è§£Tokençš„åˆ›å»ºã€å­˜å‚¨å’Œä½¿ç”¨æœºåˆ¶ã€‚**

