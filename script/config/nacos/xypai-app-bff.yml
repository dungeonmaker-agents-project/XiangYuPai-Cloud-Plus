# xypai-app-bff BFF 聚合服务配置
# Data ID: xypai-app-bff.yml
# Group: DEFAULT_GROUP
# 命名空间: dev/test/prod

spring:
  application:
    name: xypai-app-bff

# 服务端口
server:
  port: 9400

# ======================================
# BFF 特殊配置
# ======================================
# BFF 层不连接数据库，通过 Dubbo RPC 调用领域服务
# 因此不需要配置 spring.datasource

# ======================================
# Dubbo 配置（RPC 调用领域服务）
# ======================================
# XY相遇派交易模块配置
# Dubbo配置
dubbo:
  application:
    name: ${spring.application.name}
  protocol:
    name: dubbo
    port: -1
  registry:
    address: nacos://${spring.cloud.nacos.server-addr}
    group: ${spring.cloud.nacos.discovery.group}
    parameters:
      namespace: ${spring.cloud.nacos.discovery.namespace}


# ======================================
# 推荐算法配置
# ======================================
recommendation:
  # 推荐结果缓存时间（分钟）
  cache-duration: 5
  # 每页推荐数量
  page-size: 10
  # 最大推荐距离（米）
  max-distance: 50000
  # 推荐算法权重配置
  weights:
    # 距离权重
    distance: 0.3
    # 活跃度权重
    activity: 0.3
    # 技能匹配权重
    skill-match: 0.2
    # 粉丝数权重
    fans-count: 0.2

# ======================================
# Redis 缓存配置（用于缓存推荐结果）
# ======================================
# Redis 配置已在 application-common.yml 中统一配置
# 这里可以根据需要覆盖

# ======================================
# 安全配置
# ======================================
security:
  # BFF 接口白名单（不需要认证的接口）
  ignore:
    whites:
      # Swagger 文档
      - /v3/api-docs/**
      - /swagger-ui.html
      - /swagger-ui/**
      - /doc.html
      - /webjars/**
      # 健康检查
      - /actuator/health

# ======================================
# 日志配置
# ======================================
logging:
  level:
    # BFF 日志级别
    org.dromara.aggregation: info
    # Dubbo RPC 日志
    org.apache.dubbo: warn
    # Sa-Token 认证日志
    cn.dev33.satoken: info

# ======================================
# API 文档配置
# ======================================
springdoc:
  api-docs:
    enabled: true
  info:
    title: 'XyPai App BFF - 业务聚合服务接口文档'
    description: |
      ## XyPai App BFF 聚合服务

      **职责**：业务编排与数据聚合，为 App 端提供定制化聚合接口

      **特点**：
      - 无数据库访问，纯业务编排层
      - 通过 Dubbo RPC 调用领域服务
      - 批量聚合多服务数据，减少前端请求次数
      - 实现推荐算法和业务逻辑

      **核心接口**：
      - 首页用户推荐流（线上/线下）
      - 发现页内容聚合
      - 用户主页完整信息聚合
    version: 'v1.0.0'
    contact:
      name: XyPai Backend Team
      email: team@xypai.com

# ======================================
# 监控配置
# ======================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,dubbo
  endpoint:
    health:
      show-details: ALWAYS

# ======================================
# 业务配置
# ======================================
app:
  bff:
    # 是否启用 Mock 数据（开发阶段）
    enable-mock: true
    # RPC 调用批量大小
    batch-size: 50
    # 并发 RPC 调用开关
    enable-parallel-rpc: true
