# ruoyi-api å¿«é€Ÿç†è§£

> æœ€åæ›´æ–°ï¼š2025-11-26 | ç‰ˆæœ¬ï¼šv1.0.0

## ğŸ“Œ æ ¸å¿ƒå®šä½

**RPC æ¥å£å®šä¹‰å±‚** - å®šä¹‰æ‰€æœ‰å¾®æœåŠ¡é—´è¿œç¨‹è°ƒç”¨çš„æ¥å£å¥‘çº¦

- åŸºäº **Apache Dubbo 3.x** å®ç°æœåŠ¡é—´ RPC é€šä¿¡
- **çº¯æ¥å£å®šä¹‰**ï¼Œä¸åŒ…å«ä»»ä½•ä¸šåŠ¡å®ç°é€»è¾‘
- æä¾› DTO/VO æ•°æ®ä¼ è¾“å¯¹è±¡ï¼Œç¡®ä¿æœåŠ¡é—´ç±»å‹å®‰å…¨
- è¢« **èšåˆå±‚ (BFF)** å’Œ **é¢†åŸŸæœåŠ¡å±‚** å…±åŒä¾èµ–

---

## ğŸ¯ æ¨¡å—æ€»è§ˆ

| æ¨¡å— | åŒ…å | æ ¸å¿ƒæ¥å£ | å®ç°æœåŠ¡ | çŠ¶æ€ |
|------|------|----------|----------|------|
| **xypai-api-appuser** | `org.dromara.appuser.api` | `RemoteAppUserService` | xypai-user (9401) | âœ… å·²å®ç° |
| **xypai-api-chat** | `org.dromara.chat.api` | `RemoteChatService` | xypai-chat (9404) | ğŸ”œ å¾…å®ç° |
| **xypai-api-common** | `org.dromara.common.api` | 4 ä¸ªå­æœåŠ¡æ¥å£ | xypai-common (9407) | ğŸ”œ å¾…å®ç° |
| **ruoyi-api-order** | `org.dromara.order.api` | `RemoteOrderService` | xypai-order (9405) | ğŸ”œ å¾…å®ç° |
| **ruoyi-api-payment** | `org.dromara.payment.api` | `RemotePaymentService` | xypai-payment (9406) | ğŸ”œ å¾…å®ç° |

---

## ğŸ”‘ æ ¸å¿ƒæ¥å£è¯¦è§£

### 1. RemoteAppUserService (ç”¨æˆ·æœåŠ¡)

**å®ç°æœåŠ¡**: xypai-user (9401) | **è°ƒç”¨æ–¹**: xypai-auth, xypai-app-bff

| æ–¹æ³•åˆ†ç±» | æ–¹æ³•å | è¯´æ˜ |
|----------|--------|------|
| **ç™»å½•ç›¸å…³** | `getUserByMobile()` | æ‰‹æœºå·æŸ¥è¯¢ç”¨æˆ· |
| | `getUserById()` | ID æŸ¥è¯¢ç”¨æˆ· |
| | `registerOrGetByMobile()` | æ³¨å†Œæˆ–è·å–ç”¨æˆ· |
| **å¯†ç ç®¡ç†** | `checkPassword()` | æ ¡éªŒç™»å½•å¯†ç  |
| | `setPassword()` / `resetPassword()` | è®¾ç½®/é‡ç½®å¯†ç  |
| **æ”¯ä»˜å¯†ç ** | `setPaymentPassword()` | è®¾ç½®æ”¯ä»˜å¯†ç  |
| | `verifyPaymentPassword()` | éªŒè¯æ”¯ä»˜å¯†ç  |
| **è´¦å·ç®¡ç†** | `disableUser()` / `enableUser()` | ç¦ç”¨/å¯ç”¨è´¦å· |
| **ç­›é€‰åŠŸèƒ½** | `getFilterConfig()` | è·å–ç­›é€‰é…ç½® â­ |
| | `queryFilteredUsers()` | ç­›é€‰ç”¨æˆ·åˆ—è¡¨ â­ |
| **é™æ—¶ä¸“äº«** | `queryLimitedTimeUsers()` | é™æ—¶ä¸“äº«ç”¨æˆ·åˆ—è¡¨ â­ |

> â­ æ ‡è®°çš„æ–¹æ³•å·²è¢« xypai-app-bff é›†æˆä½¿ç”¨

---

### 2. RemoteChatService (èŠå¤©æœåŠ¡)

**å®ç°æœåŠ¡**: xypai-chat (9404) | **è°ƒç”¨æ–¹**: xypai-app-bff

| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `getUserUnreadCount()` | è·å–æœªè¯»æ¶ˆæ¯æ•° |
| `getUserConversations()` | è·å–ä¼šè¯åˆ—è¡¨ |
| `getConversationMessages()` | è·å–ä¼šè¯æ¶ˆæ¯ |
| `isUserOnline()` | æ£€æŸ¥ç”¨æˆ·åœ¨çº¿çŠ¶æ€ |
| `batchCheckOnlineStatus()` | æ‰¹é‡æ£€æŸ¥åœ¨çº¿çŠ¶æ€ |

---

### 3. xypai-api-common (é€šç”¨æœåŠ¡ - 4åˆ1)

**å®ç°æœåŠ¡**: xypai-common (9407)

#### 3.1 RemoteLocationService (ä½ç½®æœåŠ¡)
| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `calculateDistance()` | è®¡ç®—ä¸¤ç‚¹è·ç¦» |
| `calculateBatchDistance()` | æ‰¹é‡è®¡ç®—è·ç¦» |
| `getCityInfo()` | è·å–åŸå¸‚ä¿¡æ¯ |

#### 3.2 RemoteMediaService (åª’ä½“æœåŠ¡)
| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `getFileUrl()` | è·å–æ–‡ä»¶URL |
| `findFileByMd5()` | MD5ç§’ä¼ æŸ¥è¯¢ |
| `deleteFile()` | åˆ é™¤æ–‡ä»¶ |
| `bindFileToBiz()` | å…³è”ä¸šåŠ¡å¯¹è±¡ |

#### 3.3 RemoteNotificationService (é€šçŸ¥æœåŠ¡)
| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `sendLikeNotification()` | å‘é€ç‚¹èµé€šçŸ¥ |
| `sendCommentNotification()` | å‘é€è¯„è®ºé€šçŸ¥ |
| `sendFollowNotification()` | å‘é€å…³æ³¨é€šçŸ¥ |
| `getUnreadCount()` | è·å–æœªè¯»æ•° |

#### 3.4 RemoteReportService (ä¸¾æŠ¥æœåŠ¡)
| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `isUserBanned()` | æ£€æŸ¥ç”¨æˆ·å°ç¦ |
| `canUserPost()` | æ£€æŸ¥å‘å¸ƒæƒé™ |
| `banUser()` / `muteUser()` | å°ç¦/ç¦è¨€ç”¨æˆ· |

---

### 4. RemoteOrderService (è®¢å•æœåŠ¡)

**å®ç°æœåŠ¡**: xypai-order (9405) | **è°ƒç”¨æ–¹**: xypai-payment

| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `updateOrderStatus()` | æ›´æ–°è®¢å•çŠ¶æ€ (æ”¯ä»˜æˆåŠŸå) |
| `getOrderCount()` | è·å–è®¢å•æ•°é‡ (ç»Ÿè®¡) |

---

### 5. RemotePaymentService (æ”¯ä»˜æœåŠ¡)

**å®ç°æœåŠ¡**: xypai-payment (9406) | **è°ƒç”¨æ–¹**: xypai-order

| æ–¹æ³•å | è¯´æ˜ |
|--------|------|
| `createPayment()` | åˆ›å»ºæ”¯ä»˜è®°å½• |
| `deductBalance()` | æ‰£å‡ä½™é¢ |
| `addBalance()` | å¢åŠ ä½™é¢ |
| `refundBalance()` | é€€æ¬¾ |
| `getBalance()` | æŸ¥è¯¢ä½™é¢ |

---

## ğŸ›ï¸ è°ƒç”¨æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èšåˆæœåŠ¡å±‚ (BFF)                           â”‚
â”‚  xypai-app-bff (9400) - @DubboReference æ³¨å…¥æ¥å£             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚ Dubbo RPC
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ruoyi-api     â”‚ â”‚ ruoyi-api     â”‚ â”‚ ruoyi-api     â”‚
â”‚ (æ¥å£å®šä¹‰)    â”‚ â”‚ (æ¥å£å®šä¹‰)    â”‚ â”‚ (æ¥å£å®šä¹‰)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                 â”‚                 â”‚
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ xypai-user    â”‚ â”‚ xypai-chat    â”‚ â”‚ xypai-common  â”‚
â”‚ (å®ç°ç±»)      â”‚ â”‚ (å®ç°ç±»)      â”‚ â”‚ (å®ç°ç±»)      â”‚
â”‚ @DubboService â”‚ â”‚ @DubboService â”‚ â”‚ @DubboService â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ ç›®å½•ç»“æ„

```
ruoyi-api/
â”œâ”€â”€ xypai-api-appuser/           # ç”¨æˆ·æœåŠ¡ API
â”‚   â””â”€â”€ src/main/java/org/dromara/appuser/api/
â”‚       â”œâ”€â”€ RemoteAppUserService.java      # æ ¸å¿ƒæ¥å£ (22ä¸ªæ–¹æ³•)
â”‚       â”œâ”€â”€ model/
â”‚       â”‚   â””â”€â”€ AppLoginUser.java          # ç™»å½•ç”¨æˆ·æ¨¡å‹
â”‚       â””â”€â”€ domain/
â”‚           â”œâ”€â”€ dto/                       # è¯·æ±‚ DTO
â”‚           â”‚   â”œâ”€â”€ CreateAppUserDto.java
â”‚           â”‚   â””â”€â”€ FilterQueryDto.java
â”‚           â””â”€â”€ vo/                        # å“åº” VO
â”‚               â”œâ”€â”€ RemoteAppUserVo.java
â”‚               â”œâ”€â”€ FilterConfigVo.java
â”‚               â”œâ”€â”€ FilterUserVo.java
â”‚               â”œâ”€â”€ FilterUserPageResult.java
â”‚               â”œâ”€â”€ LimitedTimeUserVo.java
â”‚               â””â”€â”€ LimitedTimePageResult.java
â”‚
â”œâ”€â”€ xypai-api-chat/              # èŠå¤©æœåŠ¡ API
â”‚   â””â”€â”€ src/main/java/org/dromara/chat/api/
â”‚       â”œâ”€â”€ RemoteChatService.java         # æ ¸å¿ƒæ¥å£ (7ä¸ªæ–¹æ³•)
â”‚       â””â”€â”€ domain/vo/
â”‚           â”œâ”€â”€ RemoteChatUnreadCountVo.java
â”‚           â”œâ”€â”€ RemoteChatConversationVo.java
â”‚           â””â”€â”€ RemoteChatMessageVo.java
â”‚
â”œâ”€â”€ xypai-api-common/            # é€šç”¨æœåŠ¡ API (4åˆ1)
â”‚   â””â”€â”€ src/main/java/org/dromara/common/api/
â”‚       â”œâ”€â”€ location/                      # ä½ç½®æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ RemoteLocationService.java
â”‚       â”‚   â””â”€â”€ domain/
â”‚       â”œâ”€â”€ media/                         # åª’ä½“æœåŠ¡
â”‚       â”‚   â””â”€â”€ RemoteMediaService.java
â”‚       â”œâ”€â”€ notification/                  # é€šçŸ¥æœåŠ¡
â”‚       â”‚   â””â”€â”€ RemoteNotificationService.java
â”‚       â””â”€â”€ report/                        # ä¸¾æŠ¥æœåŠ¡
â”‚           â””â”€â”€ RemoteReportService.java
â”‚
â”œâ”€â”€ ruoyi-api-order/             # è®¢å•æœåŠ¡ API
â”‚   â””â”€â”€ src/main/java/org/dromara/order/api/
â”‚       â”œâ”€â”€ RemoteOrderService.java        # æ ¸å¿ƒæ¥å£ (2ä¸ªæ–¹æ³•)
â”‚       â””â”€â”€ domain/
â”‚
â””â”€â”€ ruoyi-api-payment/           # æ”¯ä»˜æœåŠ¡ API
    â””â”€â”€ src/main/java/org/dromara/payment/api/
        â”œâ”€â”€ RemotePaymentService.java      # æ ¸å¿ƒæ¥å£ (5ä¸ªæ–¹æ³•)
        â””â”€â”€ domain/
```

---

## ğŸ”¥ ä½¿ç”¨ç¤ºä¾‹

### è°ƒç”¨æ–¹ (BFF æœåŠ¡)

```java
// xypai-app-bff ä¸­ä½¿ç”¨
@DubboReference
private RemoteAppUserService remoteAppUserService;

public FilterResultVO applyFilter(FilterApplyDTO dto) {
    // 1. è·å–ç­›é€‰é…ç½®
    FilterConfigVo config = remoteAppUserService.getFilterConfig(dto.getType());

    // 2. æŸ¥è¯¢ç­›é€‰ç”¨æˆ·
    FilterUserPageResult result = remoteAppUserService.queryFilteredUsers(queryDto);

    // 3. è½¬æ¢ä¸º BFF VO è¿”å›
    return convertToFilterResult(result);
}
```

### å®ç°æ–¹ (é¢†åŸŸæœåŠ¡)

```java
// xypai-user ä¸­å®ç°
@DubboService
public class RemoteAppUserServiceImpl implements RemoteAppUserService {

    @Override
    public FilterConfigVo getFilterConfig(String type) {
        // ä»æ•°æ®åº“èšåˆæŠ€èƒ½ã€ä»·æ ¼ç­‰é…ç½®
        return filterConfigMapper.selectFilterConfig(type);
    }
}
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **æ¥å£ç‰ˆæœ¬æ§åˆ¶** - ä¿®æ”¹æ¥å£æ—¶éœ€è€ƒè™‘å‘åå…¼å®¹
2. **DTO/VO åºåˆ—åŒ–** - å¿…é¡»å®ç° `Serializable` æ¥å£
3. **å¼‚å¸¸å¤„ç†** - æŠ›å‡º `ServiceException` ç”±è°ƒç”¨æ–¹ç»Ÿä¸€å¤„ç†
4. **Null å®‰å…¨** - è¿”å›å€¼å¯èƒ½ä¸º nullï¼Œè°ƒç”¨æ–¹éœ€åšåˆ¤ç©ºå¤„ç†
5. **åˆ†é¡µçº¦å®š** - pageNum ä» 1 å¼€å§‹ï¼ŒpageSize é»˜è®¤ 10

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- `xypai-aggregation/å¿«é€Ÿç†è§£.md` - BFF èšåˆå±‚æ–‡æ¡£
- `xypai-aggregation/xypai-app-bff/å¿«é€Ÿç†è§£.md` - App BFF è¯¦ç»†æ–‡æ¡£
- `xypai-modules/xypai-user/å¿«é€Ÿç†è§£.md` - ç”¨æˆ·æœåŠ¡å®ç°æ–‡æ¡£
