# ==========================================
# Eve的Redis配置 - 聊天模块优化
# ==========================================

# ========== 网络配置 ==========
bind 0.0.0.0
port 6379
protected-mode yes
requirepass eve_redis

# ========== 持久化配置 ==========
# RDB快照
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb
dir /data

# AOF持久化（推荐开启）
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ========== 内存配置 ==========
maxmemory 256mb
maxmemory-policy allkeys-lru

# ========== 客户端配置 ==========
timeout 300
tcp-keepalive 300
maxclients 1000

# ========== 日志配置 ==========
loglevel notice
logfile ""

# ========== 慢查询日志 ==========
slowlog-log-slower-than 10000
slowlog-max-len 128

# ========== 数据库数量 ==========
databases 16

# ========== 聊天模块专用配置 ==========

# Key过期事件通知（用于输入状态过期清理）
notify-keyspace-events Ex

# ========== Key命名规范 ==========
# chat:sequence:{conversationId}      - 消息序列号（自增）
# chat:online:{userId}                 - 用户在线状态（TTL 5分钟）
# chat:typing:{conversationId}:{userId} - 正在输入状态（TTL 10秒）
# chat:members:{conversationId}        - 会话成员列表（Set）
# chat:settings:{userId}               - 消息设置缓存（TTL 1小时）
# chat:unread:{userId}                 - 未读总数（String）
# chat:last_message:{conversationId}   - 最后消息缓存（Hash）

