<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.xypai.content.mapper.ContentDraftMapper">

    <!-- ===== 查询用户草稿列表 ===== -->
    <select id="selectDraftsByUserId" resultType="com.xypai.content.domain.entity.ContentDraft">
        SELECT *
        FROM content_draft
        WHERE 
            user_id = #{userId}
            AND status = 1
        ORDER BY updated_at DESC
        LIMIT #{limit}
    </select>

    <!-- ===== 删除过期草稿 ===== -->
    <delete id="deleteExpiredDrafts">
        DELETE FROM content_draft
        WHERE 
            expire_time &lt; NOW()
            OR (status = 1 AND created_at &lt; DATE_SUB(NOW(), INTERVAL 30 DAY))
    </delete>

    <!-- ===== 统计用户草稿数量 ===== -->
    <select id="countByUserId" resultType="java.lang.Long">
        SELECT COUNT(*)
        FROM content_draft
        WHERE 
            user_id = #{userId}
            AND status = 1
    </select>

    <!-- ===== 标记草稿为已发布 ===== -->
    <update id="markAsPublished">
        UPDATE content_draft
        SET status = 0,
            updated_at = NOW()
        WHERE id = #{draftId}
    </update>

</mapper>

